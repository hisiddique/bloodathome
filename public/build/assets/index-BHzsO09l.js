import{c as _e,j as s,a as Qt,H as Ls,r as es}from"./app-Bmo3up5q.js";import{H as Zs,P as Xs}from"./public-layout-DavRu2rv.js";import{r as g,U as k,l as Js,E as Qs,u as en,b as tn,P as sn}from"./stripe-DEhpSmJl.js";import{a as nn,c as Q}from"./createLucideIcon-DVqpq5-V.js";import{C as ft}from"./check-D0gE3ZqX.js";import{M as Ve}from"./map-pin-CUMyF97U.js";import{C as ts}from"./calendar-Chh4H_-Q.js";import{t as ue,c as we,n as jt,g as rn,f as De,e as lt,d as ss,a as ns,b as rs,i as on,s as an,h as ln,j as cn,k as dn}from"./format-Dx8HDyBA.js";import{U as fn}from"./user-DwijRDrY.js";import{B as ae,b as Mt,u as os,c as un}from"./button-DzSWANc3.js";import{C as Nt}from"./checkbox-ERwv1fC2.js";import{I as Ce}from"./input-wNfwdC4B.js";import{t as K}from"./index-CsYnJTPh.js";import{B as mn}from"./building-2-B_p_gIVH.js";import{S as as}from"./search-Ch72ipEu.js";import{X as hn}from"./x-B1iQPaVG.js";import{a as is,i as pn}from"./isSameDay-C7OnRSQZ.js";import{C as xn}from"./chevron-left-DDE2JrwW.js";import{C as yn}from"./chevron-right-CmxyfaW7.js";import{u as gn,c as bn,a as vn,b as ut,P as ls,d as Nn,h as jn,R as wn,e as kn,F as Sn,D as Cn}from"./sheet-DYeZ4Q_f.js";import{c as cs,R as Dn,A as ds,C as Mn,a as _n}from"./index-B3L8qX5R.js";import{P as fs}from"./index-Bb7u4XXV.js";import{S as mt,a as ht,b as pt,c as xt,d as xe}from"./select-CFPlT4kR.js";import{C as On}from"./clock-BUDsSYec.js";import{D as Pn,a as Wn,b as En,c as Tn}from"./dialog-C4WA0_9V.js";import{S as Fn}from"./sliders-horizontal-OYRTdJeJ.js";import{S as zt}from"./star-7NlTPq8F.js";import{A as Ut}from"./award-B4alAtYi.js";import{T as In}from"./textarea-CREkdm3G.js";import{L as us}from"./loader-circle-DNWwauI4.js";import{C as An}from"./credit-card-BNVHNu_L.js";import{L as Bn}from"./lock-DD1ZaMHz.js";import{C as Yn}from"./circle-check-big-Fl9DFPPh.js";/* empty css            */import"./mapbox-fioGkFd4.js";import"./index-b6iZoh8X.js";import"./index-BtbDWhsc.js";import"./index-BdQq_4o_.js";import"./index-9OkN_xwD.js";import"./chevron-down-B8qUHuRM.js";const Rn=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],$n=nn("Tag",Rn),ms=g.createContext(void 0),_t="bloodathome_booking_draft",Ot={step:"collection",collectionType:null,isNhsTest:!1,selectedServices:[],location:null,selectedDate:null,timeOfDay:null,selectedSlot:null,selectedProvider:null,patientDetails:null,draftId:null,paymentIntentClientSecret:null,totalAmount:0,promoCode:void 0,discount:void 0};function Hn(t){const e=_e.c(34),{children:r}=t,[n,o]=g.useState(Ot);let i,l;e[0]===Symbol.for("react.memo_cache_sentinel")?(i=()=>{try{const O=localStorage.getItem(_t);if(O){const P=JSON.parse(O);P.selectedDate&&(P.selectedDate=new Date(P.selectedDate)),o({...Ot,...P})}}catch(O){console.error("Error loading booking draft:",O)}},l=[],e[0]=i,e[1]=l):(i=e[0],l=e[1]),g.useEffect(i,l);let a,c;e[2]!==n?(a=()=>{try{const O={...n,paymentIntentClientSecret:null};localStorage.setItem(_t,JSON.stringify(O))}catch(O){console.error("Error saving booking draft:",O)}},c=[n],e[2]=n,e[3]=a,e[4]=c):(a=e[3],c=e[4]),g.useEffect(a,c);let f;e[5]===Symbol.for("react.memo_cache_sentinel")?(f=O=>{o(P=>({...P,step:O}))},e[5]=f):f=e[5];const m=f;let u;e[6]===Symbol.for("react.memo_cache_sentinel")?(u=O=>{o(P=>({...P,collectionType:O}))},e[6]=u):u=e[6];const d=u;let h;e[7]===Symbol.for("react.memo_cache_sentinel")?(h=O=>{o(P=>({...P,isNhsTest:O}))},e[7]=h):h=e[7];const b=h;let j;e[8]===Symbol.for("react.memo_cache_sentinel")?(j=O=>{o(P=>({...P,selectedServices:O}))},e[8]=j):j=e[8];const N=j;let w;e[9]===Symbol.for("react.memo_cache_sentinel")?(w=O=>{o(P=>({...P,selectedServices:[...P.selectedServices,O]}))},e[9]=w):w=e[9];const D=w;let v;e[10]===Symbol.for("react.memo_cache_sentinel")?(v=O=>{o(P=>({...P,selectedServices:P.selectedServices.filter(be=>be.id!==O)}))},e[10]=v):v=e[10];const C=v;let p;e[11]===Symbol.for("react.memo_cache_sentinel")?(p=O=>{o(P=>({...P,location:O}))},e[11]=p):p=e[11];const y=p;let x;e[12]===Symbol.for("react.memo_cache_sentinel")?(x=O=>{o(P=>({...P,selectedDate:O}))},e[12]=x):x=e[12];const M=x;let _;e[13]===Symbol.for("react.memo_cache_sentinel")?(_=O=>{o(P=>({...P,timeOfDay:O}))},e[13]=_):_=e[13];const I=_;let F;e[14]===Symbol.for("react.memo_cache_sentinel")?(F=O=>{o(P=>({...P,selectedSlot:O}))},e[14]=F):F=e[14];const G=F;let U;e[15]===Symbol.for("react.memo_cache_sentinel")?(U=O=>{o(P=>({...P,selectedProvider:O}))},e[15]=U):U=e[15];const z=U;let X;e[16]===Symbol.for("react.memo_cache_sentinel")?(X=O=>{o(P=>({...P,patientDetails:O}))},e[16]=X):X=e[16];const S=X;let B;e[17]===Symbol.for("react.memo_cache_sentinel")?(B=O=>{o(P=>({...P,draftId:O}))},e[17]=B):B=e[17];const q=B;let $;e[18]===Symbol.for("react.memo_cache_sentinel")?($=O=>{o(P=>({...P,paymentIntentClientSecret:O}))},e[18]=$):$=e[18];const Z=$;let V;e[19]===Symbol.for("react.memo_cache_sentinel")?(V=O=>{o(P=>({...P,totalAmount:O}))},e[19]=V):V=e[19];const ie=V;let ee;e[20]===Symbol.for("react.memo_cache_sentinel")?(ee=O=>{o(P=>({...P,promoCode:O}))},e[20]=ee):ee=e[20];const re=ee;let te;e[21]===Symbol.for("react.memo_cache_sentinel")?(te=O=>{o(P=>({...P,discount:O}))},e[21]=te):te=e[21];const me=te;let ce;e[22]===Symbol.for("react.memo_cache_sentinel")?(ce=()=>{o(Ot),localStorage.removeItem(_t)},e[22]=ce):ce=e[22];const he=ce;let de;e[23]!==n?(de=()=>{const O=["collection","location","provider","patient","payment","success"],P=O.indexOf(n.step);P>0&&o(be=>({...be,step:O[P-1]}))},e[23]=n,e[24]=de):de=e[24];const J=de;let oe;e[25]!==n?(oe=O=>{const P=["collection","location","provider","patient","payment","success"],be=P.indexOf(n.step);P.indexOf(O)<=be&&o(Ie=>({...Ie,step:O}))},e[25]=n,e[26]=oe):oe=e[26];const ke=oe;let pe;e[27]!==J||e[28]!==ke||e[29]!==n?(pe={...n,setStep:m,setCollectionType:d,setIsNhsTest:b,setSelectedServices:N,addService:D,removeService:C,setLocation:y,setSelectedDate:M,setTimeOfDay:I,setSelectedSlot:G,setSelectedProvider:z,setPatientDetails:S,setDraftId:q,setPaymentIntentClientSecret:Z,setTotalAmount:ie,setPromoCode:re,setDiscount:me,clearBooking:he,goBack:J,goToStep:ke},e[27]=J,e[28]=ke,e[29]=n,e[30]=pe):pe=e[30];const T=pe;let se;return e[31]!==r||e[32]!==T?(se=s.jsx(ms.Provider,{value:T,children:r}),e[31]=r,e[32]=T,e[33]=se):se=e[33],se}function Ue(){const t=g.useContext(ms);if(t===void 0)throw new Error("useBooking must be used within a BookingProvider");return t}const ct=[{key:"collection",label:"Collection & Services",description:"Choose test type"},{key:"location",label:"Location & Time",description:"When and where"},{key:"provider",label:"Provider",description:"Select professional"},{key:"patient",label:"Patient Details",description:"Your information"},{key:"payment",label:"Payment",description:"Complete booking"}];function zn(t){const e=_e.c(26),{currentStep:r,onStepClick:n}=t;let o;e[0]!==r?(o=D=>D.key===r,e[0]=r,e[1]=o):o=e[1];const i=ct.findIndex(o);let l;e[2]===Symbol.for("react.memo_cache_sentinel")?(l=s.jsx("h2",{className:"text-lg font-semibold text-foreground mb-6",children:"Booking Progress"}),e[2]=l):l=e[2];let a;e[3]!==i||e[4]!==r||e[5]!==n?(a=ct.map((D,v)=>{const C=v<i,p=D.key===r,y=C&&n;return s.jsxs("button",{type:"button",onClick:()=>y&&n(D.key),disabled:!y,className:Q("w-full flex items-start gap-3 p-3 rounded-xl transition-all text-left",p&&"bg-primary/10 border border-primary",!p&&"hover:bg-accent/50",y&&"cursor-pointer",!y&&"cursor-default"),children:[s.jsx("div",{className:Q("flex items-center justify-center w-8 h-8 rounded-full shrink-0 transition-colors",C&&"bg-primary text-primary-foreground",p&&"bg-primary text-primary-foreground",!C&&!p&&"bg-muted text-muted-foreground"),children:C?s.jsx(ft,{className:"w-4 h-4"}):s.jsx("span",{className:"text-sm font-medium",children:v+1})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:Q("text-sm font-medium truncate",p?"text-primary":"text-foreground"),children:D.label}),s.jsx("div",{className:"text-xs text-muted-foreground truncate",children:D.description})]})]},D.key)}),e[3]=i,e[4]=r,e[5]=n,e[6]=a):a=e[6];let c;e[7]!==a?(c=s.jsx("div",{className:"hidden lg:block sticky top-8",children:s.jsxs("div",{className:"space-y-4",children:[l,a]})}),e[7]=a,e[8]=c):c=e[8];const f=i+1;let m;e[9]!==f?(m=s.jsxs("span",{className:"text-sm font-medium text-foreground",children:["Step ",f," of ",ct.length]}),e[9]=f,e[10]=m):m=e[10];const u=ct[i]?.label;let d;e[11]!==u?(d=s.jsx("span",{className:"text-xs text-muted-foreground",children:u}),e[11]=u,e[12]=d):d=e[12];let h;e[13]!==m||e[14]!==d?(h=s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m,d]}),e[13]=m,e[14]=d,e[15]=h):h=e[15];let b;e[16]!==i?(b=ct.map((D,v)=>s.jsx("div",{className:Q("h-1 rounded-full flex-1 transition-colors",v<=i?"bg-primary":"bg-muted")},D.key)),e[16]=i,e[17]=b):b=e[17];let j;e[18]!==b?(j=s.jsx("div",{className:"flex gap-1",children:b}),e[18]=b,e[19]=j):j=e[19];let N;e[20]!==j||e[21]!==h?(N=s.jsxs("div",{className:"lg:hidden mb-6",children:[h,j]}),e[20]=j,e[21]=h,e[22]=N):N=e[22];let w;return e[23]!==N||e[24]!==c?(w=s.jsxs("aside",{className:"w-full",children:[c,N]}),e[23]=N,e[24]=c,e[25]=w):w=e[25],w}function hs(t,e,r){const n=ue(t,r?.in);if(isNaN(e))return we(t,NaN);if(!e)return n;const o=n.getDate(),i=we(t,n.getTime());i.setMonth(n.getMonth()+e+1,0);const l=i.getDate();return o>=l?i:(n.setFullYear(i.getFullYear(),i.getMonth(),o),n)}function Un(t,e,r){return is(t,e*7,r)}function Kn(t,e,r){return hs(t,e*12,r)}function qn(t,e){let r,n=e?.in;return t.forEach(o=>{!n&&typeof o=="object"&&(n=we.bind(null,o));const i=ue(o,n);(!r||r<i||isNaN(+i))&&(r=i)}),we(n,r||NaN)}function Gn(t,e){let r,n=e?.in;return t.forEach(o=>{!n&&typeof o=="object"&&(n=we.bind(null,o));const i=ue(o,n);(!r||r>i||isNaN(+i))&&(r=i)}),we(n,r||NaN)}function ps(t,e,r){const[n,o]=jt(r?.in,t,e),i=n.getFullYear()-o.getFullYear(),l=n.getMonth()-o.getMonth();return i*12+l}function Vn(t,e){const r=ue(t,e?.in),n=r.getMonth();return r.setFullYear(r.getFullYear(),n+1,0),r.setHours(23,59,59,999),r}function xs(t,e){const[r,n]=jt(t,e.start,e.end);return{start:r,end:n}}function Ln(t,e){const{start:r,end:n}=xs(e?.in,t);let o=+r>+n;const i=o?+r:+n,l=o?n:r;l.setHours(0,0,0,0),l.setDate(1);let a=1;const c=[];for(;+l<=i;)c.push(we(r,l)),l.setMonth(l.getMonth()+a);return o?c.reverse():c}function Zn(t,e){const r=ue(t,e?.in);return r.setDate(1),r.setHours(0,0,0,0),r}function Xn(t,e){const r=ue(t,e?.in),n=r.getFullYear();return r.setFullYear(n+1,0,0),r.setHours(23,59,59,999),r}function Jn(t,e){const{start:r,end:n}=xs(e?.in,t);let o=+r>+n;const i=o?+r:+n,l=o?n:r;l.setHours(0,0,0,0),l.setMonth(0,1);let a=1;const c=[];for(;+l<=i;)c.push(we(r,l)),l.setFullYear(l.getFullYear()+a);return o?c.reverse():c}function ys(t,e){const r=rn(),n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,o=ue(t,e?.in),i=o.getDay(),l=(i<n?-7:0)+6-(i-n);return o.setDate(o.getDate()+l),o.setHours(23,59,59,999),o}function Qn(t,e){return ys(t,{...e,weekStartsOn:1})}function er(t,e){const r=ue(t,e?.in),n=r.getFullYear(),o=r.getMonth(),i=we(r,0);return i.setFullYear(n,o+1,0),i.setHours(0,0,0,0),i.getDate()}function tr(t,e){return ue(t,e?.in).getMonth()}function sr(t,e){return ue(t,e?.in).getFullYear()}function nr(t,e){return+ue(t)>+ue(e)}function rr(t,e){return+ue(t)<+ue(e)}function or(t,e,r){const[n,o]=jt(r?.in,t,e);return n.getFullYear()===o.getFullYear()&&n.getMonth()===o.getMonth()}function ar(t,e,r){const[n,o]=jt(r?.in,t,e);return n.getFullYear()===o.getFullYear()}function ir(t,e,r){const n=ue(t,r?.in),o=n.getFullYear(),i=n.getDate(),l=we(t,0);l.setFullYear(o,e,15),l.setHours(0,0,0,0);const a=er(l);return n.setMonth(e,Math.min(i,a)),n}function lr(t,e,r){const n=ue(t,r?.in);return isNaN(+n)?we(t,NaN):(n.setFullYear(e),n)}function cr(t){const e=_e.c(91),{className:r}=t,{selectedServices:n,collectionType:o,location:i,selectedDate:l,timeOfDay:a,selectedProvider:c,discount:f}=Ue(),{serviceFeePercentage:m,vatPercentage:u}=Qt().props;let d,h,b,j,N,w,D,v,C,p,y,x,M,_,I,F;if(e[0]!==r||e[1]!==o||e[2]!==f||e[3]!==i||e[4]!==l||e[5]!==c||e[6]!==n||e[7]!==m||e[8]!==a||e[9]!==u){D=Symbol.for("react.early_return_sentinel");e:{const he=n.reduce(fr,0);h=he*(m/100),F=(he+h)*(u/100);const de=he+h+F;if(d=f?de-f:de,n.length===0){D=null;break e}e[26]!==r?(M=Q("bg-card border border-border rounded-2xl p-6 space-y-4",r),e[26]=r,e[27]=M):M=e[27],e[28]===Symbol.for("react.memo_cache_sentinel")?(_=s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Booking Summary"}),e[28]=_):_=e[28],e[29]!==o||e[30]!==i?(I=o&&s.jsxs("div",{className:"flex items-start gap-3 pb-3 border-b border-border",children:[s.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center shrink-0",children:s.jsx(Ve,{className:"w-5 h-5 text-primary"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-sm font-medium text-foreground capitalize",children:o.replace("_"," ")}),i&&s.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:i.postcode})]})]}),e[29]=o,e[30]=i,e[31]=I):I=e[31],e[32]!==l||e[33]!==a?(j=l&&s.jsxs("div",{className:"flex items-start gap-3 pb-3 border-b border-border",children:[s.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center shrink-0",children:s.jsx(ts,{className:"w-5 h-5 text-primary"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-sm font-medium text-foreground",children:De(l,"EEE, dd MMM yyyy")}),a&&s.jsx("div",{className:"text-xs text-muted-foreground mt-1 capitalize",children:a})]})]}),e[32]=l,e[33]=a,e[34]=j):j=e[34],e[35]!==c?(N=c&&s.jsxs("div",{className:"flex items-start gap-3 pb-3 border-b border-border",children:[s.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center shrink-0",children:s.jsx(fn,{className:"w-5 h-5 text-primary"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-sm font-medium text-foreground",children:c.user.full_name}),s.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:c.type.name})]})]}),e[35]=c,e[36]=N):N=e[36];let J;e[37]===Symbol.for("react.memo_cache_sentinel")?(J=s.jsx("h4",{className:"text-sm font-medium text-foreground",children:"Selected Tests"}),e[37]=J):J=e[37];let oe;e[38]!==n?(oe=n.map(dr),e[38]=n,e[39]=oe):oe=e[39],e[40]!==oe?(w=s.jsxs("div",{className:"space-y-2",children:[J,oe]}),e[40]=oe,e[41]=w):w=e[41],x="space-y-2 pt-3 border-t border-border",p="flex items-center justify-between text-sm",e[42]===Symbol.for("react.memo_cache_sentinel")?(y=s.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e[42]=y):y=e[42],b="text-foreground",v="£",C=he.toFixed(2)}e[0]=r,e[1]=o,e[2]=f,e[3]=i,e[4]=l,e[5]=c,e[6]=n,e[7]=m,e[8]=a,e[9]=u,e[10]=d,e[11]=h,e[12]=b,e[13]=j,e[14]=N,e[15]=w,e[16]=D,e[17]=v,e[18]=C,e[19]=p,e[20]=y,e[21]=x,e[22]=M,e[23]=_,e[24]=I,e[25]=F}else d=e[10],h=e[11],b=e[12],j=e[13],N=e[14],w=e[15],D=e[16],v=e[17],C=e[18],p=e[19],y=e[20],x=e[21],M=e[22],_=e[23],I=e[24],F=e[25];if(D!==Symbol.for("react.early_return_sentinel"))return D;let G;e[43]!==b||e[44]!==v||e[45]!==C?(G=s.jsxs("span",{className:b,children:[v,C]}),e[43]=b,e[44]=v,e[45]=C,e[46]=G):G=e[46];let U;e[47]!==G||e[48]!==p||e[49]!==y?(U=s.jsxs("div",{className:p,children:[y,G]}),e[47]=G,e[48]=p,e[49]=y,e[50]=U):U=e[50];let z;e[51]!==m?(z=s.jsxs("span",{className:"text-muted-foreground",children:["Service Fee (",m,"%)"]}),e[51]=m,e[52]=z):z=e[52];let X;e[53]!==h?(X=h.toFixed(2),e[53]=h,e[54]=X):X=e[54];let S;e[55]!==X?(S=s.jsxs("span",{className:"text-foreground",children:["£",X]}),e[55]=X,e[56]=S):S=e[56];let B;e[57]!==z||e[58]!==S?(B=s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[z,S]}),e[57]=z,e[58]=S,e[59]=B):B=e[59];let q;e[60]!==u?(q=s.jsxs("span",{className:"text-muted-foreground",children:["VAT (",u,"%)"]}),e[60]=u,e[61]=q):q=e[61];let $;e[62]!==F?($=F.toFixed(2),e[62]=F,e[63]=$):$=e[63];let Z;e[64]!==$?(Z=s.jsxs("span",{className:"text-foreground",children:["£",$]}),e[64]=$,e[65]=Z):Z=e[65];let V;e[66]!==q||e[67]!==Z?(V=s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[q,Z]}),e[66]=q,e[67]=Z,e[68]=V):V=e[68];let ie;e[69]!==f?(ie=f&&f>0&&s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Discount"}),s.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["-£",f.toFixed(2)]})]}),e[69]=f,e[70]=ie):ie=e[70];let ee;e[71]===Symbol.for("react.memo_cache_sentinel")?(ee=s.jsx("span",{className:"text-foreground",children:"Total"}),e[71]=ee):ee=e[71];let re;e[72]!==d?(re=d.toFixed(2),e[72]=d,e[73]=re):re=e[73];let te;e[74]!==re?(te=s.jsxs("div",{className:"flex items-center justify-between text-base font-semibold pt-2 border-t border-border",children:[ee,s.jsxs("span",{className:"text-primary",children:["£",re]})]}),e[74]=re,e[75]=te):te=e[75];let me;e[76]!==U||e[77]!==B||e[78]!==V||e[79]!==ie||e[80]!==te||e[81]!==x?(me=s.jsxs("div",{className:x,children:[U,B,V,ie,te]}),e[76]=U,e[77]=B,e[78]=V,e[79]=ie,e[80]=te,e[81]=x,e[82]=me):me=e[82];let ce;return e[83]!==j||e[84]!==N||e[85]!==w||e[86]!==me||e[87]!==M||e[88]!==_||e[89]!==I?(ce=s.jsxs("div",{className:M,children:[_,I,j,N,w,me]}),e[83]=j,e[84]=N,e[85]=w,e[86]=me,e[87]=M,e[88]=_,e[89]=I,e[90]=ce):ce=e[90],ce}function dr(t){return s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"text-sm text-foreground truncate",children:t.service_name}),s.jsx("div",{className:"text-xs text-muted-foreground",children:t.service_code})]}),s.jsxs("div",{className:"text-sm font-medium text-foreground whitespace-nowrap",children:["£",(t.base_price||0).toFixed(2)]})]},t.id)}function fr(t,e){const r=e.base_price||0;return t+r}function Ee(){return document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}function It(){return{fetchServices:async f=>{try{const m=f?`/api/services?collection_type=${f}`:"/api/services",u=await fetch(m,{headers:{Accept:"application/json","X-CSRF-TOKEN":Ee()}});if(!u.ok)throw new Error("Failed to fetch services");const d=await u.json();return d.services||d}catch(m){throw console.error("Error fetching services:",m),m}},fetchCollectionTypes:async()=>{try{const f=await fetch("/api/collection-types",{headers:{Accept:"application/json","X-CSRF-TOKEN":Ee()}});if(!f.ok)throw new Error("Failed to fetch collection types");const m=await f.json();return m.collectionTypes||m}catch(f){throw console.error("Error fetching collection types:",f),f}},searchProviders:async f=>{try{const m=new URLSearchParams({lat:f.lat.toString(),lng:f.lng.toString()});f.service_ids&&f.service_ids.length>0&&f.service_ids.forEach(h=>m.append("service_ids[]",h)),f.collection_type&&m.append("collection_type",f.collection_type),f.date&&m.append("date",f.date),f.radius_km&&m.append("radius_km",f.radius_km.toString());const u=await fetch(`/api/providers/search?${m.toString()}`,{headers:{Accept:"application/json","X-CSRF-TOKEN":Ee()}});if(!u.ok)throw new Error("Failed to search providers");const d=await u.json();return d.providers||d}catch(m){throw console.error("Error searching providers:",m),m}},getProviderAvailability:async(f,m)=>{try{const u=await fetch(`/api/providers/${f}/availability?date=${m}`,{headers:{Accept:"application/json","X-CSRF-TOKEN":Ee()}});if(!u.ok)throw new Error("Failed to fetch provider availability");const d=await u.json();return d.timeSlots||d}catch(u){throw console.error("Error fetching provider availability:",u),u}},createDraft:async f=>{try{const m=await fetch("/api/booking-drafts",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":Ee()},body:JSON.stringify(f)});if(!m.ok){const d=await m.json();throw new Error(d.message||"Failed to create booking draft")}const u=await m.json();return u.draft||u}catch(m){throw console.error("Error creating booking draft:",m),m}},updateDraft:async(f,m)=>{try{const u=await fetch(`/api/booking-drafts/${f}`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":Ee()},body:JSON.stringify(m)});if(!u.ok){const h=await u.json();throw new Error(h.message||"Failed to update booking draft")}const d=await u.json();return d.draft||d}catch(u){throw console.error("Error updating booking draft:",u),u}},createPaymentIntent:async f=>{try{const m=await fetch(`/api/booking-drafts/${f}/payment-intent`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":Ee()}});if(!m.ok){const d=await m.json();throw new Error(d.message||"Failed to create payment intent")}const u=await m.json();return{clientSecret:u.clientSecret,amount:u.amount}}catch(m){throw console.error("Error creating payment intent:",m),m}},applyPromoCode:async(f,m)=>{try{const u=await fetch(`/api/booking-drafts/${f}/promo-code`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":Ee()},body:JSON.stringify({code:m})});if(!u.ok){const h=await u.json();throw new Error(h.message||"Invalid promo code")}const d=await u.json();return{discount:d.discount,newTotal:d.newTotal,code:d.code}}catch(u){throw console.error("Error applying promo code:",u),u}},confirmBooking:async(f,m)=>{try{const u=await fetch("/api/bookings/confirm",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":Ee()},body:JSON.stringify({payment_intent_id:f,draft_id:m})});if(!u.ok){const h=await u.json();throw new Error(h.message||"Failed to confirm booking")}const d=await u.json();return{bookingId:d.bookingId,confirmationNumber:d.confirmationNumber}}catch(u){throw console.error("Error confirming booking:",u),u}}}}function Kt(){const{collectionType:t,isNhsTest:e,selectedServices:r,setCollectionType:n,setIsNhsTest:o,setSelectedServices:i,setStep:l}=Ue(),{fetchServices:a,fetchCollectionTypes:c}=It(),[f,m]=g.useState([]),[u,d]=g.useState([]),[h,b]=g.useState([]),[j,N]=g.useState(""),[w,D]=g.useState(!0);g.useEffect(()=>{(async()=>{D(!0);try{const[M,_]=await Promise.all([c(),a()]);m(M),d(_),b(_)}catch(M){K.error("Failed to load services"),console.error("Error loading data:",M)}finally{D(!1)}})()},[]),g.useEffect(()=>{if(!j.trim()){b(u);return}const x=j.toLowerCase(),M=u.filter(_=>_.service_name.toLowerCase().includes(x)||_.service_code.toLowerCase().includes(x)||_.service_description?.toLowerCase().includes(x)||_.category.name.toLowerCase().includes(x));b(M)},[j,u]);const v=x=>{n(x)},C=x=>{const M=r.some(_=>_.id===x.id);i(M?r.filter(_=>_.id!==x.id):[...r,x])},p=()=>{if(!t){K.error("Please select a collection type");return}if(r.length===0){K.error("Please select at least one service");return}l("location")},y=r.reduce((x,M)=>x+(M.base_price||0),0);return w?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-semibold text-foreground mb-2",children:"Choose Your Test"}),s.jsx("p",{className:"text-muted-foreground",children:"Select collection type and services you need"})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{className:"text-sm font-medium text-foreground",children:"Collection Type"}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[s.jsx("button",{type:"button",onClick:()=>v("home_visit"),className:Q("p-4 rounded-xl border-2 transition-all text-left",t==="home_visit"?"border-primary bg-primary/5":"border-border hover:border-primary/50"),children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:Q("w-10 h-10 rounded-lg flex items-center justify-center shrink-0",t==="home_visit"?"bg-primary":"bg-muted"),children:s.jsx(Zs,{className:Q("w-5 h-5",t==="home_visit"?"text-primary-foreground":"text-foreground")})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-foreground",children:"Home Visit"}),s.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:"Professional visits your location"})]}),t==="home_visit"&&s.jsx(ft,{className:"w-5 h-5 text-primary shrink-0"})]})}),s.jsx("button",{type:"button",onClick:()=>v("clinic"),className:Q("p-4 rounded-xl border-2 transition-all text-left",t==="clinic"?"border-primary bg-primary/5":"border-border hover:border-primary/50"),children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:Q("w-10 h-10 rounded-lg flex items-center justify-center shrink-0",t==="clinic"?"bg-primary":"bg-muted"),children:s.jsx(mn,{className:Q("w-5 h-5",t==="clinic"?"text-primary-foreground":"text-foreground")})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-foreground",children:"Clinic Visit"}),s.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:"Visit a clinic location"})]}),t==="clinic"&&s.jsx(ft,{className:"w-5 h-5 text-primary shrink-0"})]})})]})]}),s.jsxs("div",{className:"flex items-center gap-3 p-4 bg-accent/30 rounded-xl border border-border",children:[s.jsx(Nt,{id:"nhs-test",checked:e,onCheckedChange:x=>o(x===!0)}),s.jsx("label",{htmlFor:"nhs-test",className:"text-sm text-foreground cursor-pointer flex-1",children:"This is an NHS test (requires NHS number)"})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:"text-sm font-medium text-foreground",children:"Select Services"}),r.length>0&&s.jsxs("span",{className:"text-xs text-muted-foreground",children:[r.length," selected"]})]}),s.jsxs("div",{className:"relative",children:[s.jsx(as,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),s.jsx(Ce,{type:"text",placeholder:"Search services...",value:j,onChange:x=>N(x.target.value),className:"pl-10 pr-10"}),j&&s.jsx("button",{type:"button",onClick:()=>N(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:s.jsx(hn,{className:"w-4 h-4"})})]}),s.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:h.length===0?s.jsx("div",{className:"text-center py-8 text-muted-foreground",children:s.jsx("p",{children:"No services found"})}):h.map(x=>{const M=r.some(_=>_.id===x.id);return s.jsx("button",{type:"button",onClick:()=>C(x),className:Q("w-full p-4 rounded-xl border transition-all text-left",M?"border-primary bg-primary/5":"border-border hover:border-primary/50"),role:"checkbox","aria-checked":M,"aria-label":`${x.service_name}, £${(x.base_price||0).toFixed(2)}`,children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:Q("w-5 h-5 rounded border-2 flex items-center justify-center shrink-0 mt-0.5",M?"bg-primary border-primary":"border-muted-foreground"),"aria-hidden":"true",children:M&&s.jsx(ft,{className:"w-3 h-3 text-primary-foreground"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"font-medium text-foreground",children:x.service_name}),s.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[x.service_code," • ",x.category.name]}),x.service_description&&s.jsx("div",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:x.service_description})]}),s.jsxs("div",{className:"text-sm font-medium text-foreground whitespace-nowrap",children:["£",(x.base_price||0).toFixed(2)]})]})},x.id)})})]}),r.length>0&&s.jsxs("div",{className:"bg-card border border-border rounded-xl p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("span",{className:"text-sm font-medium text-foreground",children:"Selected Tests"}),s.jsx("button",{type:"button",onClick:()=>i([]),className:"text-xs text-muted-foreground hover:text-foreground",children:"Clear all"})]}),s.jsxs("div",{className:"space-y-2",children:[r.map(x=>s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsx("span",{className:"text-foreground truncate",children:x.service_name}),s.jsxs("span",{className:"font-medium text-foreground whitespace-nowrap ml-2",children:["£",(x.base_price||0).toFixed(2)]})]},x.id)),s.jsxs("div",{className:"flex items-center justify-between text-base font-semibold pt-2 border-t border-border",children:[s.jsx("span",{className:"text-foreground",children:"Subtotal"}),s.jsxs("span",{className:"text-primary",children:["£",y.toFixed(2)]})]})]})]}),s.jsx("div",{className:"pt-4",children:s.jsx(ae,{onClick:p,disabled:!t||r.length===0,className:"w-full py-6 text-base",size:"lg",children:"Continue to Location"})})]})}function ur(t,e,r="long"){return new Intl.DateTimeFormat("en-US",{hour:"numeric",timeZone:t,timeZoneName:r}).format(e).split(/\s/g).slice(2).join(" ")}const mr={},dt={};function Ge(t,e){try{const n=(mr[t]||=new Intl.DateTimeFormat("en-US",{timeZone:t,timeZoneName:"longOffset"}).format)(e).split("GMT")[1];return n in dt?dt[n]:qt(n,n.split(":"))}catch{if(t in dt)return dt[t];const r=t?.match(hr);return r?qt(t,r.slice(1)):NaN}}const hr=/([+-]\d\d):?(\d\d)?/;function qt(t,e){const r=+(e[0]||0),n=+(e[1]||0),o=+(e[2]||0)/60;return dt[t]=r*60+n>0?r*60+n+o:r*60-n-o}class Me extends Date{constructor(...e){super(),e.length>1&&typeof e[e.length-1]=="string"&&(this.timeZone=e.pop()),this.internal=new Date,isNaN(Ge(this.timeZone,this))?this.setTime(NaN):e.length?typeof e[0]=="number"&&(e.length===1||e.length===2&&typeof e[1]!="number")?this.setTime(e[0]):typeof e[0]=="string"?this.setTime(+new Date(e[0])):e[0]instanceof Date?this.setTime(+e[0]):(this.setTime(+new Date(...e)),gs(this),Ft(this)):this.setTime(Date.now())}static tz(e,...r){return r.length?new Me(...r,e):new Me(Date.now(),e)}withTimeZone(e){return new Me(+this,e)}getTimezoneOffset(){const e=-Ge(this.timeZone,this);return e>0?Math.floor(e):Math.ceil(e)}setTime(e){return Date.prototype.setTime.apply(this,arguments),Ft(this),+this}[Symbol.for("constructDateFrom")](e){return new Me(+new Date(e),this.timeZone)}}const Gt=/^(get|set)(?!UTC)/;Object.getOwnPropertyNames(Date.prototype).forEach(t=>{if(!Gt.test(t))return;const e=t.replace(Gt,"$1UTC");Me.prototype[e]&&(t.startsWith("get")?Me.prototype[t]=function(){return this.internal[e]()}:(Me.prototype[t]=function(){return Date.prototype[e].apply(this.internal,arguments),pr(this),+this},Me.prototype[e]=function(){return Date.prototype[e].apply(this,arguments),Ft(this),+this}))});function Ft(t){t.internal.setTime(+t),t.internal.setUTCSeconds(t.internal.getUTCSeconds()-Math.round(-Ge(t.timeZone,t)*60))}function pr(t){Date.prototype.setFullYear.call(t,t.internal.getUTCFullYear(),t.internal.getUTCMonth(),t.internal.getUTCDate()),Date.prototype.setHours.call(t,t.internal.getUTCHours(),t.internal.getUTCMinutes(),t.internal.getUTCSeconds(),t.internal.getUTCMilliseconds()),gs(t)}function gs(t){const e=Ge(t.timeZone,t),r=e>0?Math.floor(e):Math.ceil(e),n=new Date(+t);n.setUTCHours(n.getUTCHours()-1);const o=-new Date(+t).getTimezoneOffset(),i=-new Date(+n).getTimezoneOffset(),l=o-i,a=Date.prototype.getHours.apply(t)!==t.internal.getUTCHours();l&&a&&t.internal.setUTCMinutes(t.internal.getUTCMinutes()+l);const c=o-r;c&&Date.prototype.setUTCMinutes.call(t,Date.prototype.getUTCMinutes.call(t)+c);const f=new Date(+t);f.setUTCSeconds(0);const m=o>0?f.getSeconds():(f.getSeconds()-60)%60,u=Math.round(-(Ge(t.timeZone,t)*60))%60;(u||m)&&(t.internal.setUTCSeconds(t.internal.getUTCSeconds()+u),Date.prototype.setUTCSeconds.call(t,Date.prototype.getUTCSeconds.call(t)+u+m));const d=Ge(t.timeZone,t),h=d>0?Math.floor(d):Math.ceil(d),j=-new Date(+t).getTimezoneOffset()-h,N=h!==r,w=j-c;if(N&&w){Date.prototype.setUTCMinutes.call(t,Date.prototype.getUTCMinutes.call(t)+w);const D=Ge(t.timeZone,t),v=D>0?Math.floor(D):Math.ceil(D),C=h-v;C&&(t.internal.setUTCMinutes(t.internal.getUTCMinutes()+C),Date.prototype.setUTCMinutes.call(t,Date.prototype.getUTCMinutes.call(t)+C))}}class fe extends Me{static tz(e,...r){return r.length?new fe(...r,e):new fe(Date.now(),e)}toISOString(){const[e,r,n]=this.tzComponents(),o=`${e}${r}:${n}`;return this.internal.toISOString().slice(0,-1)+o}toString(){return`${this.toDateString()} ${this.toTimeString()}`}toDateString(){const[e,r,n,o]=this.internal.toUTCString().split(" ");return`${e?.slice(0,-1)} ${n} ${r} ${o}`}toTimeString(){const e=this.internal.toUTCString().split(" ")[4],[r,n,o]=this.tzComponents();return`${e} GMT${r}${n}${o} (${ur(this.timeZone,this)})`}toLocaleString(e,r){return Date.prototype.toLocaleString.call(this,e,{...r,timeZone:r?.timeZone||this.timeZone})}toLocaleDateString(e,r){return Date.prototype.toLocaleDateString.call(this,e,{...r,timeZone:r?.timeZone||this.timeZone})}toLocaleTimeString(e,r){return Date.prototype.toLocaleTimeString.call(this,e,{...r,timeZone:r?.timeZone||this.timeZone})}tzComponents(){const e=this.getTimezoneOffset(),r=e>0?"-":"+",n=String(Math.floor(Math.abs(e)/60)).padStart(2,"0"),o=String(Math.abs(e)%60).padStart(2,"0");return[r,n,o]}withTimeZone(e){return new fe(+this,e)}[Symbol.for("constructDateFrom")](e){return new fe(+new Date(e),this.timeZone)}}const Vt=5,xr=4;function yr(t,e){const r=e.startOfMonth(t),n=r.getDay()>0?r.getDay():7,o=e.addDays(t,-n+1),i=e.addDays(o,Vt*7-1);return e.getMonth(t)===e.getMonth(i)?Vt:xr}function bs(t,e){const r=e.startOfMonth(t),n=r.getDay();return n===1?r:n===0?e.addDays(r,-6):e.addDays(r,-1*(n-1))}function gr(t,e){const r=bs(t,e),n=yr(t,e);return e.addDays(r,n*7-1)}const vs={...lt,labels:{labelDayButton:(t,e,r,n)=>{let o;n&&typeof n.format=="function"?o=n.format.bind(n):o=(l,a)=>De(l,a,{locale:lt,...r});let i=o(t,"PPPP");return e.today&&(i=`Today, ${i}`),e.selected&&(i=`${i}, selected`),i},labelMonthDropdown:"Choose the Month",labelNext:"Go to the Next Month",labelPrevious:"Go to the Previous Month",labelWeekNumber:t=>`Week ${t}`,labelYearDropdown:"Choose the Year",labelGrid:(t,e,r)=>{let n;return r&&typeof r.format=="function"?n=r.format.bind(r):n=(o,i)=>De(o,i,{locale:lt,...e}),n(t,"LLLL yyyy")},labelGridcell:(t,e,r,n)=>{let o;n&&typeof n.format=="function"?o=n.format.bind(n):o=(l,a)=>De(l,a,{locale:lt,...r});let i=o(t,"PPPP");return e?.today&&(i=`Today, ${i}`),i},labelNav:"Navigation bar",labelWeekNumberHeader:"Week Number",labelWeekday:(t,e,r)=>{let n;return r&&typeof r.format=="function"?n=r.format.bind(r):n=(o,i)=>De(o,i,{locale:lt,...e}),n(t,"cccc")}}};class ge{constructor(e,r){this.Date=Date,this.today=()=>this.overrides?.today?this.overrides.today():this.options.timeZone?fe.tz(this.options.timeZone):new this.Date,this.newDate=(n,o,i)=>this.overrides?.newDate?this.overrides.newDate(n,o,i):this.options.timeZone?new fe(n,o,i,this.options.timeZone):new Date(n,o,i),this.addDays=(n,o)=>this.overrides?.addDays?this.overrides.addDays(n,o):is(n,o),this.addMonths=(n,o)=>this.overrides?.addMonths?this.overrides.addMonths(n,o):hs(n,o),this.addWeeks=(n,o)=>this.overrides?.addWeeks?this.overrides.addWeeks(n,o):Un(n,o),this.addYears=(n,o)=>this.overrides?.addYears?this.overrides.addYears(n,o):Kn(n,o),this.differenceInCalendarDays=(n,o)=>this.overrides?.differenceInCalendarDays?this.overrides.differenceInCalendarDays(n,o):ss(n,o),this.differenceInCalendarMonths=(n,o)=>this.overrides?.differenceInCalendarMonths?this.overrides.differenceInCalendarMonths(n,o):ps(n,o),this.eachMonthOfInterval=n=>this.overrides?.eachMonthOfInterval?this.overrides.eachMonthOfInterval(n):Ln(n),this.eachYearOfInterval=n=>{const o=this.overrides?.eachYearOfInterval?this.overrides.eachYearOfInterval(n):Jn(n),i=new Set(o.map(a=>this.getYear(a)));if(i.size===o.length)return o;const l=[];return i.forEach(a=>{l.push(new Date(a,0,1))}),l},this.endOfBroadcastWeek=n=>this.overrides?.endOfBroadcastWeek?this.overrides.endOfBroadcastWeek(n):gr(n,this),this.endOfISOWeek=n=>this.overrides?.endOfISOWeek?this.overrides.endOfISOWeek(n):Qn(n),this.endOfMonth=n=>this.overrides?.endOfMonth?this.overrides.endOfMonth(n):Vn(n),this.endOfWeek=(n,o)=>this.overrides?.endOfWeek?this.overrides.endOfWeek(n,o):ys(n,this.options),this.endOfYear=n=>this.overrides?.endOfYear?this.overrides.endOfYear(n):Xn(n),this.format=(n,o,i)=>{const l=this.overrides?.format?this.overrides.format(n,o,this.options):De(n,o,this.options);return this.options.numerals&&this.options.numerals!=="latn"?this.replaceDigits(l):l},this.getISOWeek=n=>this.overrides?.getISOWeek?this.overrides.getISOWeek(n):ns(n),this.getMonth=(n,o)=>this.overrides?.getMonth?this.overrides.getMonth(n,this.options):tr(n,this.options),this.getYear=(n,o)=>this.overrides?.getYear?this.overrides.getYear(n,this.options):sr(n,this.options),this.getWeek=(n,o)=>this.overrides?.getWeek?this.overrides.getWeek(n,this.options):rs(n,this.options),this.isAfter=(n,o)=>this.overrides?.isAfter?this.overrides.isAfter(n,o):nr(n,o),this.isBefore=(n,o)=>this.overrides?.isBefore?this.overrides.isBefore(n,o):rr(n,o),this.isDate=n=>this.overrides?.isDate?this.overrides.isDate(n):on(n),this.isSameDay=(n,o)=>this.overrides?.isSameDay?this.overrides.isSameDay(n,o):pn(n,o),this.isSameMonth=(n,o)=>this.overrides?.isSameMonth?this.overrides.isSameMonth(n,o):or(n,o),this.isSameYear=(n,o)=>this.overrides?.isSameYear?this.overrides.isSameYear(n,o):ar(n,o),this.max=n=>this.overrides?.max?this.overrides.max(n):qn(n),this.min=n=>this.overrides?.min?this.overrides.min(n):Gn(n),this.setMonth=(n,o)=>this.overrides?.setMonth?this.overrides.setMonth(n,o):ir(n,o),this.setYear=(n,o)=>this.overrides?.setYear?this.overrides.setYear(n,o):lr(n,o),this.startOfBroadcastWeek=(n,o)=>this.overrides?.startOfBroadcastWeek?this.overrides.startOfBroadcastWeek(n,this):bs(n,this),this.startOfDay=n=>this.overrides?.startOfDay?this.overrides.startOfDay(n):an(n),this.startOfISOWeek=n=>this.overrides?.startOfISOWeek?this.overrides.startOfISOWeek(n):ln(n),this.startOfMonth=n=>this.overrides?.startOfMonth?this.overrides.startOfMonth(n):Zn(n),this.startOfWeek=(n,o)=>this.overrides?.startOfWeek?this.overrides.startOfWeek(n,this.options):cn(n,this.options),this.startOfYear=n=>this.overrides?.startOfYear?this.overrides.startOfYear(n):dn(n),this.options={locale:vs,...e},this.overrides=r}getDigitMap(){const{numerals:e="latn"}=this.options,r=new Intl.NumberFormat("en-US",{numberingSystem:e}),n={};for(let o=0;o<10;o++)n[o.toString()]=r.format(o);return n}replaceDigits(e){const r=this.getDigitMap();return e.replace(/\d/g,n=>r[n]||n)}formatNumber(e){return this.replaceDigits(e.toString())}getMonthYearOrder(){const e=this.options.locale?.code;return e&&ge.yearFirstLocales.has(e)?"year-first":"month-first"}formatMonthYear(e){const{locale:r,timeZone:n,numerals:o}=this.options,i=r?.code;if(i&&ge.yearFirstLocales.has(i))try{return new Intl.DateTimeFormat(i,{month:"long",year:"numeric",timeZone:n,numberingSystem:o}).format(e)}catch{}const l=this.getMonthYearOrder()==="year-first"?"y LLLL":"LLLL y";return this.format(e,l)}}ge.yearFirstLocales=new Set(["eu","hu","ja","ja-Hira","ja-JP","ko","ko-KR","lt","lt-LT","lv","lv-LV","mn","mn-MN","zh","zh-CN","zh-HK","zh-TW"]);const Oe=new ge;class Ns{constructor(e,r,n=Oe){this.date=e,this.displayMonth=r,this.outside=!!(r&&!n.isSameMonth(e,r)),this.dateLib=n,this.isoDate=n.format(e,"yyyy-MM-dd"),this.displayMonthId=n.format(r,"yyyy-MM"),this.dateMonthId=n.format(e,"yyyy-MM")}isEqualTo(e){return this.dateLib.isSameDay(e.date,this.date)&&this.dateLib.isSameMonth(e.displayMonth,this.displayMonth)}}class br{constructor(e,r){this.date=e,this.weeks=r}}class vr{constructor(e,r){this.days=r,this.weekNumber=e}}function Nr(t){return k.createElement("button",{...t})}function jr(t){return k.createElement("span",{...t})}function wr(t){const{size:e=24,orientation:r="left",className:n}=t;return k.createElement("svg",{className:n,width:e,height:e,viewBox:"0 0 24 24"},r==="up"&&k.createElement("polygon",{points:"6.77 17 12.5 11.43 18.24 17 20 15.28 12.5 8 5 15.28"}),r==="down"&&k.createElement("polygon",{points:"6.77 8 12.5 13.57 18.24 8 20 9.72 12.5 17 5 9.72"}),r==="left"&&k.createElement("polygon",{points:"16 18.112 9.81111111 12 16 5.87733333 14.0888889 4 6 12 14.0888889 20"}),r==="right"&&k.createElement("polygon",{points:"8 18.112 14.18888889 12 8 5.87733333 9.91111111 4 18 12 9.91111111 20"}))}function kr(t){const{day:e,modifiers:r,...n}=t;return k.createElement("td",{...n})}function Sr(t){const{day:e,modifiers:r,...n}=t,o=k.useRef(null);return k.useEffect(()=>{r.focused&&o.current?.focus()},[r.focused]),k.createElement("button",{ref:o,...n})}var W;(function(t){t.Root="root",t.Chevron="chevron",t.Day="day",t.DayButton="day_button",t.CaptionLabel="caption_label",t.Dropdowns="dropdowns",t.Dropdown="dropdown",t.DropdownRoot="dropdown_root",t.Footer="footer",t.MonthGrid="month_grid",t.MonthCaption="month_caption",t.MonthsDropdown="months_dropdown",t.Month="month",t.Months="months",t.Nav="nav",t.NextMonthButton="button_next",t.PreviousMonthButton="button_previous",t.Week="week",t.Weeks="weeks",t.Weekday="weekday",t.Weekdays="weekdays",t.WeekNumber="week_number",t.WeekNumberHeader="week_number_header",t.YearsDropdown="years_dropdown"})(W||(W={}));var ne;(function(t){t.disabled="disabled",t.hidden="hidden",t.outside="outside",t.focused="focused",t.today="today"})(ne||(ne={}));var je;(function(t){t.range_end="range_end",t.range_middle="range_middle",t.range_start="range_start",t.selected="selected"})(je||(je={}));var ye;(function(t){t.weeks_before_enter="weeks_before_enter",t.weeks_before_exit="weeks_before_exit",t.weeks_after_enter="weeks_after_enter",t.weeks_after_exit="weeks_after_exit",t.caption_after_enter="caption_after_enter",t.caption_after_exit="caption_after_exit",t.caption_before_enter="caption_before_enter",t.caption_before_exit="caption_before_exit"})(ye||(ye={}));function Cr(t){const{options:e,className:r,components:n,classNames:o,...i}=t,l=[o[W.Dropdown],r].join(" "),a=e?.find(({value:c})=>c===i.value);return k.createElement("span",{"data-disabled":i.disabled,className:o[W.DropdownRoot]},k.createElement(n.Select,{className:l,...i},e?.map(({value:c,label:f,disabled:m})=>k.createElement(n.Option,{key:c,value:c,disabled:m},f))),k.createElement("span",{className:o[W.CaptionLabel],"aria-hidden":!0},a?.label,k.createElement(n.Chevron,{orientation:"down",size:18,className:o[W.Chevron]})))}function Dr(t){return k.createElement("div",{...t})}function Mr(t){return k.createElement("div",{...t})}function _r(t){const{calendarMonth:e,displayIndex:r,...n}=t;return k.createElement("div",{...n},t.children)}function Or(t){const{calendarMonth:e,displayIndex:r,...n}=t;return k.createElement("div",{...n})}function Pr(t){return k.createElement("table",{...t})}function Wr(t){return k.createElement("div",{...t})}const js=g.createContext(void 0);function yt(){const t=g.useContext(js);if(t===void 0)throw new Error("useDayPicker() must be used within a custom component.");return t}function Er(t){const{components:e}=yt();return k.createElement(e.Dropdown,{...t})}function Tr(t){const{onPreviousClick:e,onNextClick:r,previousMonth:n,nextMonth:o,...i}=t,{components:l,classNames:a,labels:{labelPrevious:c,labelNext:f}}=yt(),m=g.useCallback(d=>{o&&r?.(d)},[o,r]),u=g.useCallback(d=>{n&&e?.(d)},[n,e]);return k.createElement("nav",{...i},k.createElement(l.PreviousMonthButton,{type:"button",className:a[W.PreviousMonthButton],tabIndex:n?void 0:-1,"aria-disabled":n?void 0:!0,"aria-label":c(n),onClick:u},k.createElement(l.Chevron,{disabled:n?void 0:!0,className:a[W.Chevron],orientation:"left"})),k.createElement(l.NextMonthButton,{type:"button",className:a[W.NextMonthButton],tabIndex:o?void 0:-1,"aria-disabled":o?void 0:!0,"aria-label":f(o),onClick:m},k.createElement(l.Chevron,{disabled:o?void 0:!0,orientation:"right",className:a[W.Chevron]})))}function Fr(t){const{components:e}=yt();return k.createElement(e.Button,{...t})}function Ir(t){return k.createElement("option",{...t})}function Ar(t){const{components:e}=yt();return k.createElement(e.Button,{...t})}function Br(t){const{rootRef:e,...r}=t;return k.createElement("div",{...r,ref:e})}function Yr(t){return k.createElement("select",{...t})}function Rr(t){const{week:e,...r}=t;return k.createElement("tr",{...r})}function $r(t){return k.createElement("th",{...t})}function Hr(t){return k.createElement("thead",{"aria-hidden":!0},k.createElement("tr",{...t}))}function zr(t){const{week:e,...r}=t;return k.createElement("th",{...r})}function Ur(t){return k.createElement("th",{...t})}function Kr(t){return k.createElement("tbody",{...t})}function qr(t){const{components:e}=yt();return k.createElement(e.Dropdown,{...t})}const Gr=Object.freeze(Object.defineProperty({__proto__:null,Button:Nr,CaptionLabel:jr,Chevron:wr,Day:kr,DayButton:Sr,Dropdown:Cr,DropdownNav:Dr,Footer:Mr,Month:_r,MonthCaption:Or,MonthGrid:Pr,Months:Wr,MonthsDropdown:Er,Nav:Tr,NextMonthButton:Fr,Option:Ir,PreviousMonthButton:Ar,Root:Br,Select:Yr,Week:Rr,WeekNumber:zr,WeekNumberHeader:Ur,Weekday:$r,Weekdays:Hr,Weeks:Kr,YearsDropdown:qr},Symbol.toStringTag,{value:"Module"}));function Te(t,e,r=!1,n=Oe){let{from:o,to:i}=t;const{differenceInCalendarDays:l,isSameDay:a}=n;return o&&i?(l(i,o)<0&&([o,i]=[i,o]),l(e,o)>=(r?1:0)&&l(i,e)>=(r?1:0)):!r&&i?a(i,e):!r&&o?a(o,e):!1}function At(t){return!!(t&&typeof t=="object"&&"before"in t&&"after"in t)}function wt(t){return!!(t&&typeof t=="object"&&"from"in t)}function Bt(t){return!!(t&&typeof t=="object"&&"after"in t)}function Yt(t){return!!(t&&typeof t=="object"&&"before"in t)}function ws(t){return!!(t&&typeof t=="object"&&"dayOfWeek"in t)}function ks(t,e){return Array.isArray(t)&&t.every(e.isDate)}function Fe(t,e,r=Oe){const n=Array.isArray(e)?e:[e],{isSameDay:o,differenceInCalendarDays:i,isAfter:l}=r;return n.some(a=>{if(typeof a=="boolean")return a;if(r.isDate(a))return o(t,a);if(ks(a,r))return a.some(c=>o(t,c));if(wt(a))return Te(a,t,!1,r);if(ws(a))return Array.isArray(a.dayOfWeek)?a.dayOfWeek.includes(t.getDay()):a.dayOfWeek===t.getDay();if(At(a)){const c=i(a.before,t),f=i(a.after,t),m=c>0,u=f<0;return l(a.before,a.after)?u&&m:m||u}return Bt(a)?i(t,a.after)>0:Yt(a)?i(a.before,t)>0:typeof a=="function"?a(t):!1})}function Vr(t,e,r,n,o){const{disabled:i,hidden:l,modifiers:a,showOutsideDays:c,broadcastCalendar:f,today:m=o.today()}=e,{isSameDay:u,isSameMonth:d,startOfMonth:h,isBefore:b,endOfMonth:j,isAfter:N}=o,w=r&&h(r),D=n&&j(n),v={[ne.focused]:[],[ne.outside]:[],[ne.disabled]:[],[ne.hidden]:[],[ne.today]:[]},C={};for(const p of t){const{date:y,displayMonth:x}=p,M=!!(x&&!d(y,x)),_=!!(w&&b(y,w)),I=!!(D&&N(y,D)),F=!!(i&&Fe(y,i,o)),G=!!(l&&Fe(y,l,o))||_||I||!f&&!c&&M||f&&c===!1&&M,U=u(y,m);M&&v.outside.push(p),F&&v.disabled.push(p),G&&v.hidden.push(p),U&&v.today.push(p),a&&Object.keys(a).forEach(z=>{const X=a?.[z];X&&Fe(y,X,o)&&(C[z]?C[z].push(p):C[z]=[p])})}return p=>{const y={[ne.focused]:!1,[ne.disabled]:!1,[ne.hidden]:!1,[ne.outside]:!1,[ne.today]:!1},x={};for(const M in v){const _=v[M];y[M]=_.some(I=>I===p)}for(const M in C)x[M]=C[M].some(_=>_===p);return{...y,...x}}}function Lr(t,e,r={}){return Object.entries(t).filter(([,o])=>o===!0).reduce((o,[i])=>(r[i]?o.push(r[i]):e[ne[i]]?o.push(e[ne[i]]):e[je[i]]&&o.push(e[je[i]]),o),[e[W.Day]])}function Zr(t){return{...Gr,...t}}function Xr(t){const e={"data-mode":t.mode??void 0,"data-required":"required"in t?t.required:void 0,"data-multiple-months":t.numberOfMonths&&t.numberOfMonths>1||void 0,"data-week-numbers":t.showWeekNumber||void 0,"data-broadcast-calendar":t.broadcastCalendar||void 0,"data-nav-layout":t.navLayout||void 0};return Object.entries(t).forEach(([r,n])=>{r.startsWith("data-")&&(e[r]=n)}),e}function Jr(){const t={};for(const e in W)t[W[e]]=`rdp-${W[e]}`;for(const e in ne)t[ne[e]]=`rdp-${ne[e]}`;for(const e in je)t[je[e]]=`rdp-${je[e]}`;for(const e in ye)t[ye[e]]=`rdp-${ye[e]}`;return t}function Ss(t,e,r){return(r??new ge(e)).formatMonthYear(t)}const Qr=Ss;function eo(t,e,r){return(r??new ge(e)).format(t,"d")}function to(t,e=Oe){return e.format(t,"LLLL")}function so(t,e,r){return(r??new ge(e)).format(t,"cccccc")}function no(t,e=Oe){return t<10?e.formatNumber(`0${t.toLocaleString()}`):e.formatNumber(`${t.toLocaleString()}`)}function ro(){return""}function Cs(t,e=Oe){return e.format(t,"yyyy")}const oo=Cs,ao=Object.freeze(Object.defineProperty({__proto__:null,formatCaption:Ss,formatDay:eo,formatMonthCaption:Qr,formatMonthDropdown:to,formatWeekNumber:no,formatWeekNumberHeader:ro,formatWeekdayName:so,formatYearCaption:oo,formatYearDropdown:Cs},Symbol.toStringTag,{value:"Module"}));function io(t){return t?.formatMonthCaption&&!t.formatCaption&&(t.formatCaption=t.formatMonthCaption),t?.formatYearCaption&&!t.formatYearDropdown&&(t.formatYearDropdown=t.formatYearCaption),{...ao,...t}}function Rt(t,e,r,n){let o=(n??new ge(r)).format(t,"PPPP");return e.today&&(o=`Today, ${o}`),e.selected&&(o=`${o}, selected`),o}const lo=Rt;function $t(t,e,r){return(r??new ge(e)).formatMonthYear(t)}const co=$t;function Ds(t,e,r,n){let o=(n??new ge(r)).format(t,"PPPP");return e?.today&&(o=`Today, ${o}`),o}function Ms(t){return"Choose the Month"}function _s(){return""}const fo="Go to the Next Month";function Os(t,e){return fo}function Ps(t){return"Go to the Previous Month"}function Ws(t,e,r){return(r??new ge(e)).format(t,"cccc")}function Es(t,e){return`Week ${t}`}function Ts(t){return"Week Number"}function Fs(t){return"Choose the Year"}const uo=Object.freeze(Object.defineProperty({__proto__:null,labelCaption:co,labelDay:lo,labelDayButton:Rt,labelGrid:$t,labelGridcell:Ds,labelMonthDropdown:Ms,labelNav:_s,labelNext:Os,labelPrevious:Ps,labelWeekNumber:Es,labelWeekNumberHeader:Ts,labelWeekday:Ws,labelYearDropdown:Fs},Symbol.toStringTag,{value:"Module"})),Ne=(t,e,r)=>e||(r?typeof r=="function"?r:(...n)=>r:t);function mo(t,e){const r=e.locale?.labels??{};return{...uo,...t??{},labelDayButton:Ne(Rt,t?.labelDayButton,r.labelDayButton),labelMonthDropdown:Ne(Ms,t?.labelMonthDropdown,r.labelMonthDropdown),labelNext:Ne(Os,t?.labelNext,r.labelNext),labelPrevious:Ne(Ps,t?.labelPrevious,r.labelPrevious),labelWeekNumber:Ne(Es,t?.labelWeekNumber,r.labelWeekNumber),labelYearDropdown:Ne(Fs,t?.labelYearDropdown,r.labelYearDropdown),labelGrid:Ne($t,t?.labelGrid,r.labelGrid),labelGridcell:Ne(Ds,t?.labelGridcell,r.labelGridcell),labelNav:Ne(_s,t?.labelNav,r.labelNav),labelWeekNumberHeader:Ne(Ts,t?.labelWeekNumberHeader,r.labelWeekNumberHeader),labelWeekday:Ne(Ws,t?.labelWeekday,r.labelWeekday)}}function ho(t,e,r,n,o){const{startOfMonth:i,startOfYear:l,endOfYear:a,eachMonthOfInterval:c,getMonth:f}=o;return c({start:l(t),end:a(t)}).map(d=>{const h=n.formatMonthDropdown(d,o),b=f(d),j=e&&d<i(e)||r&&d>i(r)||!1;return{value:b,label:h,disabled:j}})}function po(t,e={},r={}){let n={...e?.[W.Day]};return Object.entries(t).filter(([,o])=>o===!0).forEach(([o])=>{n={...n,...r?.[o]}}),n}function xo(t,e,r,n){const o=n??t.today(),i=r?t.startOfBroadcastWeek(o,t):e?t.startOfISOWeek(o):t.startOfWeek(o),l=[];for(let a=0;a<7;a++){const c=t.addDays(i,a);l.push(c)}return l}function yo(t,e,r,n,o=!1){if(!t||!e)return;const{startOfYear:i,endOfYear:l,eachYearOfInterval:a,getYear:c}=n,f=i(t),m=l(e),u=a({start:f,end:m});return o&&u.reverse(),u.map(d=>{const h=r.formatYearDropdown(d,n);return{value:c(d),label:h,disabled:!1}})}function go(t,e={}){const{weekStartsOn:r,locale:n}=e,o=r??n?.options?.weekStartsOn??0,i=a=>{const c=typeof a=="number"||typeof a=="string"?new Date(a):a;return new fe(c.getFullYear(),c.getMonth(),c.getDate(),12,0,0,t)},l=a=>{const c=i(a);return new Date(c.getFullYear(),c.getMonth(),c.getDate(),0,0,0,0)};return{today:()=>i(fe.tz(t)),newDate:(a,c,f)=>new fe(a,c,f,12,0,0,t),startOfDay:a=>i(a),startOfWeek:(a,c)=>{const f=i(a),m=c?.weekStartsOn??o,u=(f.getDay()-m+7)%7;return f.setDate(f.getDate()-u),f},startOfISOWeek:a=>{const c=i(a),f=(c.getDay()-1+7)%7;return c.setDate(c.getDate()-f),c},startOfMonth:a=>{const c=i(a);return c.setDate(1),c},startOfYear:a=>{const c=i(a);return c.setMonth(0,1),c},endOfWeek:(a,c)=>{const f=i(a),d=(((c?.weekStartsOn??o)+6)%7-f.getDay()+7)%7;return f.setDate(f.getDate()+d),f},endOfISOWeek:a=>{const c=i(a),f=(7-c.getDay())%7;return c.setDate(c.getDate()+f),c},endOfMonth:a=>{const c=i(a);return c.setMonth(c.getMonth()+1,0),c},endOfYear:a=>{const c=i(a);return c.setMonth(11,31),c},eachMonthOfInterval:a=>{const c=i(a.start),f=i(a.end),m=[],u=new fe(c.getFullYear(),c.getMonth(),1,12,0,0,t),d=f.getFullYear()*12+f.getMonth();for(;u.getFullYear()*12+u.getMonth()<=d;)m.push(new fe(u,t)),u.setMonth(u.getMonth()+1,1);return m},addDays:(a,c)=>{const f=i(a);return f.setDate(f.getDate()+c),f},addWeeks:(a,c)=>{const f=i(a);return f.setDate(f.getDate()+c*7),f},addMonths:(a,c)=>{const f=i(a);return f.setMonth(f.getMonth()+c),f},addYears:(a,c)=>{const f=i(a);return f.setFullYear(f.getFullYear()+c),f},eachYearOfInterval:a=>{const c=i(a.start),f=i(a.end),m=[],u=new fe(c.getFullYear(),0,1,12,0,0,t);for(;u.getFullYear()<=f.getFullYear();)m.push(new fe(u,t)),u.setFullYear(u.getFullYear()+1,0,1);return m},getWeek:(a,c)=>{const f=l(a);return rs(f,{weekStartsOn:c?.weekStartsOn??o,firstWeekContainsDate:c?.firstWeekContainsDate??n?.options?.firstWeekContainsDate??1})},getISOWeek:a=>{const c=l(a);return ns(c)},differenceInCalendarDays:(a,c)=>{const f=l(a),m=l(c);return ss(f,m)},differenceInCalendarMonths:(a,c)=>{const f=l(a),m=l(c);return ps(f,m)}}}const gt=t=>t instanceof HTMLElement?t:null,Pt=t=>[...t.querySelectorAll("[data-animated-month]")??[]],bo=t=>gt(t.querySelector("[data-animated-month]")),Wt=t=>gt(t.querySelector("[data-animated-caption]")),Et=t=>gt(t.querySelector("[data-animated-weeks]")),vo=t=>gt(t.querySelector("[data-animated-nav]")),No=t=>gt(t.querySelector("[data-animated-weekdays]"));function jo(t,e,{classNames:r,months:n,focused:o,dateLib:i}){const l=g.useRef(null),a=g.useRef(n),c=g.useRef(!1);g.useLayoutEffect(()=>{const f=a.current;if(a.current=n,!e||!t.current||!(t.current instanceof HTMLElement)||n.length===0||f.length===0||n.length!==f.length)return;const m=i.isSameMonth(n[0].date,f[0].date),u=i.isAfter(n[0].date,f[0].date),d=u?r[ye.caption_after_enter]:r[ye.caption_before_enter],h=u?r[ye.weeks_after_enter]:r[ye.weeks_before_enter],b=l.current,j=t.current.cloneNode(!0);if(j instanceof HTMLElement?(Pt(j).forEach(v=>{if(!(v instanceof HTMLElement))return;const C=bo(v);C&&v.contains(C)&&v.removeChild(C);const p=Wt(v);p&&p.classList.remove(d);const y=Et(v);y&&y.classList.remove(h)}),l.current=j):l.current=null,c.current||m||o)return;const N=b instanceof HTMLElement?Pt(b):[],w=Pt(t.current);if(w?.every(D=>D instanceof HTMLElement)&&N&&N.every(D=>D instanceof HTMLElement)){c.current=!0,t.current.style.isolation="isolate";const D=vo(t.current);D&&(D.style.zIndex="1"),w.forEach((v,C)=>{const p=N[C];if(!p)return;v.style.position="relative",v.style.overflow="hidden";const y=Wt(v);y&&y.classList.add(d);const x=Et(v);x&&x.classList.add(h);const M=()=>{c.current=!1,t.current&&(t.current.style.isolation=""),D&&(D.style.zIndex=""),y&&y.classList.remove(d),x&&x.classList.remove(h),v.style.position="",v.style.overflow="",v.contains(p)&&v.removeChild(p)};p.style.pointerEvents="none",p.style.position="absolute",p.style.overflow="hidden",p.setAttribute("aria-hidden","true");const _=No(p);_&&(_.style.opacity="0");const I=Wt(p);I&&(I.classList.add(u?r[ye.caption_before_exit]:r[ye.caption_after_exit]),I.addEventListener("animationend",M));const F=Et(p);F&&F.classList.add(u?r[ye.weeks_before_exit]:r[ye.weeks_after_exit]),v.insertBefore(p,v.firstChild)})}})}function wo(t,e,r,n){const o=t[0],i=t[t.length-1],{ISOWeek:l,fixedWeeks:a,broadcastCalendar:c}=r??{},{addDays:f,differenceInCalendarDays:m,differenceInCalendarMonths:u,endOfBroadcastWeek:d,endOfISOWeek:h,endOfMonth:b,endOfWeek:j,isAfter:N,startOfBroadcastWeek:w,startOfISOWeek:D,startOfWeek:v}=n,C=c?w(o,n):l?D(o):v(o),p=c?d(i):l?h(b(i)):j(b(i)),y=e&&(c?d(e):l?h(e):j(e)),x=y&&N(p,y)?y:p,M=m(x,C),_=u(i,o)+1,I=[];for(let U=0;U<=M;U++){const z=f(C,U);I.push(z)}const G=(c?35:42)*_;if(a&&I.length<G){const U=G-I.length;for(let z=0;z<U;z++){const X=f(I[I.length-1],1);I.push(X)}}return I}function ko(t){const e=[];return t.reduce((r,n)=>{const o=n.weeks.reduce((i,l)=>i.concat(l.days.slice()),e.slice());return r.concat(o.slice())},e.slice())}function So(t,e,r,n){const{numberOfMonths:o=1}=r,i=[];for(let l=0;l<o;l++){const a=n.addMonths(t,l);if(e&&a>e)break;i.push(a)}return i}function Lt(t,e,r,n){const{month:o,defaultMonth:i,today:l=n.today(),numberOfMonths:a=1}=t;let c=o||i||l;const{differenceInCalendarMonths:f,addMonths:m,startOfMonth:u}=n;if(r&&f(r,c)<a-1){const d=-1*(a-1);c=m(r,d)}return e&&f(c,e)<0&&(c=e),u(c)}function Co(t,e,r,n){const{addDays:o,endOfBroadcastWeek:i,endOfISOWeek:l,endOfMonth:a,endOfWeek:c,getISOWeek:f,getWeek:m,startOfBroadcastWeek:u,startOfISOWeek:d,startOfWeek:h}=n,b=t.reduce((j,N)=>{const w=r.broadcastCalendar?u(N,n):r.ISOWeek?d(N):h(N),D=r.broadcastCalendar?i(N):r.ISOWeek?l(a(N)):c(a(N)),v=e.filter(x=>x>=w&&x<=D),C=r.broadcastCalendar?35:42;if(r.fixedWeeks&&v.length<C){const x=e.filter(M=>{const _=C-v.length;return M>D&&M<=o(D,_)});v.push(...x)}const p=v.reduce((x,M)=>{const _=r.ISOWeek?f(M):m(M),I=x.find(G=>G.weekNumber===_),F=new Ns(M,N,n);return I?I.days.push(F):x.push(new vr(_,[F])),x},[]),y=new br(N,p);return j.push(y),j},[]);return r.reverseMonths?b.reverse():b}function Do(t,e){let{startMonth:r,endMonth:n}=t;const{startOfYear:o,startOfDay:i,startOfMonth:l,endOfMonth:a,addYears:c,endOfYear:f,newDate:m,today:u}=e,{fromYear:d,toYear:h,fromMonth:b,toMonth:j}=t;!r&&b&&(r=b),!r&&d&&(r=e.newDate(d,0,1)),!n&&j&&(n=j),!n&&h&&(n=m(h,11,31));const N=t.captionLayout==="dropdown"||t.captionLayout==="dropdown-years";return r?r=l(r):d?r=m(d,0,1):!r&&N&&(r=o(c(t.today??u(),-100))),n?n=a(n):h?n=m(h,11,31):!n&&N&&(n=f(t.today??u())),[r&&i(r),n&&i(n)]}function Mo(t,e,r,n){if(r.disableNavigation)return;const{pagedNavigation:o,numberOfMonths:i=1}=r,{startOfMonth:l,addMonths:a,differenceInCalendarMonths:c}=n,f=o?i:1,m=l(t);if(!e)return a(m,f);if(!(c(e,t)<i))return a(m,f)}function _o(t,e,r,n){if(r.disableNavigation)return;const{pagedNavigation:o,numberOfMonths:i}=r,{startOfMonth:l,addMonths:a,differenceInCalendarMonths:c}=n,f=o?i??1:1,m=l(t);if(!e)return a(m,-f);if(!(c(m,e)<=0))return a(m,-f)}function Oo(t){const e=[];return t.reduce((r,n)=>r.concat(n.weeks.slice()),e.slice())}function kt(t,e){const[r,n]=g.useState(t);return[e===void 0?r:e,n]}function Po(t,e){const[r,n]=Do(t,e),{startOfMonth:o,endOfMonth:i}=e,l=Lt(t,r,n,e),[a,c]=kt(l,t.month?l:void 0);g.useEffect(()=>{const C=Lt(t,r,n,e);c(C)},[t.timeZone]);const{months:f,weeks:m,days:u,previousMonth:d,nextMonth:h}=g.useMemo(()=>{const C=So(a,n,{numberOfMonths:t.numberOfMonths},e),p=wo(C,t.endMonth?i(t.endMonth):void 0,{ISOWeek:t.ISOWeek,fixedWeeks:t.fixedWeeks,broadcastCalendar:t.broadcastCalendar},e),y=Co(C,p,{broadcastCalendar:t.broadcastCalendar,fixedWeeks:t.fixedWeeks,ISOWeek:t.ISOWeek,reverseMonths:t.reverseMonths},e),x=Oo(y),M=ko(y),_=_o(a,r,t,e),I=Mo(a,n,t,e);return{months:y,weeks:x,days:M,previousMonth:_,nextMonth:I}},[e,a.getTime(),n?.getTime(),r?.getTime(),t.disableNavigation,t.broadcastCalendar,t.endMonth?.getTime(),t.fixedWeeks,t.ISOWeek,t.numberOfMonths,t.pagedNavigation,t.reverseMonths]),{disableNavigation:b,onMonthChange:j}=t,N=C=>m.some(p=>p.days.some(y=>y.isEqualTo(C))),w=C=>{if(b)return;let p=o(C);r&&p<o(r)&&(p=o(r)),n&&p>o(n)&&(p=o(n)),c(p),j?.(p)};return{months:f,weeks:m,days:u,navStart:r,navEnd:n,previousMonth:d,nextMonth:h,goToMonth:w,goToDay:C=>{N(C)||w(C.date)}}}var Se;(function(t){t[t.Today=0]="Today",t[t.Selected=1]="Selected",t[t.LastFocused=2]="LastFocused",t[t.FocusedModifier=3]="FocusedModifier"})(Se||(Se={}));function Zt(t){return!t[ne.disabled]&&!t[ne.hidden]&&!t[ne.outside]}function Wo(t,e,r,n){let o,i=-1;for(const l of t){const a=e(l);Zt(a)&&(a[ne.focused]&&i<Se.FocusedModifier?(o=l,i=Se.FocusedModifier):n?.isEqualTo(l)&&i<Se.LastFocused?(o=l,i=Se.LastFocused):r(l.date)&&i<Se.Selected?(o=l,i=Se.Selected):a[ne.today]&&i<Se.Today&&(o=l,i=Se.Today))}return o||(o=t.find(l=>Zt(e(l)))),o}function Eo(t,e,r,n,o,i,l){const{ISOWeek:a,broadcastCalendar:c}=i,{addDays:f,addMonths:m,addWeeks:u,addYears:d,endOfBroadcastWeek:h,endOfISOWeek:b,endOfWeek:j,max:N,min:w,startOfBroadcastWeek:D,startOfISOWeek:v,startOfWeek:C}=l;let y={day:f,week:u,month:m,year:d,startOfWeek:x=>c?D(x,l):a?v(x):C(x),endOfWeek:x=>c?h(x):a?b(x):j(x)}[t](r,e==="after"?1:-1);return e==="before"&&n?y=N([n,y]):e==="after"&&o&&(y=w([o,y])),y}function Is(t,e,r,n,o,i,l,a=0){if(a>365)return;const c=Eo(t,e,r.date,n,o,i,l),f=!!(i.disabled&&Fe(c,i.disabled,l)),m=!!(i.hidden&&Fe(c,i.hidden,l)),u=c,d=new Ns(c,u,l);return!f&&!m?d:Is(t,e,d,n,o,i,l,a+1)}function To(t,e,r,n,o){const{autoFocus:i}=t,[l,a]=g.useState(),c=Wo(e.days,r,n||(()=>!1),l),[f,m]=g.useState(i?c:void 0);return{isFocusTarget:j=>!!c?.isEqualTo(j),setFocused:m,focused:f,blur:()=>{a(f),m(void 0)},moveFocus:(j,N)=>{if(!f)return;const w=Is(j,N,f,e.navStart,e.navEnd,t,o);w&&(t.disableNavigation&&!e.days.some(v=>v.isEqualTo(w))||(e.goToDay(w),m(w)))}}}function Fo(t,e){const{selected:r,required:n,onSelect:o}=t,[i,l]=kt(r,o?r:void 0),a=o?r:i,{isSameDay:c}=e,f=h=>a?.some(b=>c(b,h))??!1,{min:m,max:u}=t;return{selected:a,select:(h,b,j)=>{let N=[...a??[]];if(f(h)){if(a?.length===m||n&&a?.length===1)return;N=a?.filter(w=>!c(w,h))}else a?.length===u?N=[h]:N=[...N,h];return o||l(N),o?.(N,h,b,j),N},isSelected:f}}function Io(t,e,r=0,n=0,o=!1,i=Oe){const{from:l,to:a}=e||{},{isSameDay:c,isAfter:f,isBefore:m}=i;let u;if(!l&&!a)u={from:t,to:r>0?void 0:t};else if(l&&!a)c(l,t)?r===0?u={from:l,to:t}:o?u={from:l,to:void 0}:u=void 0:m(t,l)?u={from:t,to:l}:u={from:l,to:t};else if(l&&a)if(c(l,t)&&c(a,t))o?u={from:l,to:a}:u=void 0;else if(c(l,t))u={from:l,to:r>0?void 0:t};else if(c(a,t))u={from:t,to:r>0?void 0:t};else if(m(t,l))u={from:t,to:a};else if(f(t,l))u={from:l,to:t};else if(f(t,a))u={from:l,to:t};else throw new Error("Invalid range");if(u?.from&&u?.to){const d=i.differenceInCalendarDays(u.to,u.from);n>0&&d>n?u={from:t,to:void 0}:r>1&&d<r&&(u={from:t,to:void 0})}return u}function Ao(t,e,r=Oe){const n=Array.isArray(e)?e:[e];let o=t.from;const i=r.differenceInCalendarDays(t.to,t.from),l=Math.min(i,6);for(let a=0;a<=l;a++){if(n.includes(o.getDay()))return!0;o=r.addDays(o,1)}return!1}function Xt(t,e,r=Oe){return Te(t,e.from,!1,r)||Te(t,e.to,!1,r)||Te(e,t.from,!1,r)||Te(e,t.to,!1,r)}function Bo(t,e,r=Oe){const n=Array.isArray(e)?e:[e];if(n.filter(a=>typeof a!="function").some(a=>typeof a=="boolean"?a:r.isDate(a)?Te(t,a,!1,r):ks(a,r)?a.some(c=>Te(t,c,!1,r)):wt(a)?a.from&&a.to?Xt(t,{from:a.from,to:a.to},r):!1:ws(a)?Ao(t,a.dayOfWeek,r):At(a)?r.isAfter(a.before,a.after)?Xt(t,{from:r.addDays(a.after,1),to:r.addDays(a.before,-1)},r):Fe(t.from,a,r)||Fe(t.to,a,r):Bt(a)||Yt(a)?Fe(t.from,a,r)||Fe(t.to,a,r):!1))return!0;const l=n.filter(a=>typeof a=="function");if(l.length){let a=t.from;const c=r.differenceInCalendarDays(t.to,t.from);for(let f=0;f<=c;f++){if(l.some(m=>m(a)))return!0;a=r.addDays(a,1)}}return!1}function Yo(t,e){const{disabled:r,excludeDisabled:n,selected:o,required:i,onSelect:l}=t,[a,c]=kt(o,l?o:void 0),f=l?o:a;return{selected:f,select:(d,h,b)=>{const{min:j,max:N}=t,w=d?Io(d,f,j,N,i,e):void 0;return n&&r&&w?.from&&w.to&&Bo({from:w.from,to:w.to},r,e)&&(w.from=d,w.to=void 0),l||c(w),l?.(w,d,h,b),w},isSelected:d=>f&&Te(f,d,!1,e)}}function Ro(t,e){const{selected:r,required:n,onSelect:o}=t,[i,l]=kt(r,o?r:void 0),a=o?r:i,{isSameDay:c}=e;return{selected:a,select:(u,d,h)=>{let b=u;return!n&&a&&a&&c(u,a)&&(b=void 0),o||l(b),o?.(b,u,d,h),b},isSelected:u=>a?c(a,u):!1}}function $o(t,e){const r=Ro(t,e),n=Fo(t,e),o=Yo(t,e);switch(t.mode){case"single":return r;case"multiple":return n;case"range":return o;default:return}}function ve(t,e){return t instanceof fe&&t.timeZone===e?t:new fe(t,e)}function nt(t,e,r){return ve(t,e)}function Jt(t,e,r){return typeof t=="boolean"||typeof t=="function"?t:t instanceof Date?nt(t,e):Array.isArray(t)?t.map(n=>n instanceof Date?nt(n,e):n):wt(t)?{...t,from:t.from?ve(t.from,e):t.from,to:t.to?ve(t.to,e):t.to}:At(t)?{before:nt(t.before,e),after:nt(t.after,e)}:Bt(t)?{after:nt(t.after,e)}:Yt(t)?{before:nt(t.before,e)}:t}function Tt(t,e,r){return t&&(Array.isArray(t)?t.map(n=>Jt(n,e)):Jt(t,e))}function Ho(t){let e=t;const r=e.timeZone;if(r&&(e={...t,timeZone:r},e.today&&(e.today=ve(e.today,r)),e.month&&(e.month=ve(e.month,r)),e.defaultMonth&&(e.defaultMonth=ve(e.defaultMonth,r)),e.startMonth&&(e.startMonth=ve(e.startMonth,r)),e.endMonth&&(e.endMonth=ve(e.endMonth,r)),e.mode==="single"&&e.selected?e.selected=ve(e.selected,r):e.mode==="multiple"&&e.selected?e.selected=e.selected?.map(A=>ve(A,r)):e.mode==="range"&&e.selected&&(e.selected={from:e.selected.from?ve(e.selected.from,r):e.selected.from,to:e.selected.to?ve(e.selected.to,r):e.selected.to}),e.disabled!==void 0&&(e.disabled=Tt(e.disabled,r)),e.hidden!==void 0&&(e.hidden=Tt(e.hidden,r)),e.modifiers)){const A={};Object.keys(e.modifiers).forEach(H=>{A[H]=Tt(e.modifiers?.[H],r)}),e.modifiers=A}const{components:n,formatters:o,labels:i,dateLib:l,locale:a,classNames:c}=g.useMemo(()=>{const A={...vs,...e.locale},H=e.broadcastCalendar?1:e.weekStartsOn,E=e.noonSafe&&e.timeZone?go(e.timeZone,{weekStartsOn:H,locale:A}):void 0,R=e.dateLib&&E?{...E,...e.dateLib}:e.dateLib??E,le=new ge({locale:A,weekStartsOn:H,firstWeekContainsDate:e.firstWeekContainsDate,useAdditionalWeekYearTokens:e.useAdditionalWeekYearTokens,useAdditionalDayOfYearTokens:e.useAdditionalDayOfYearTokens,timeZone:e.timeZone,numerals:e.numerals},R);return{dateLib:le,components:Zr(e.components),formatters:io(e.formatters),labels:mo(e.labels,le.options),locale:A,classNames:{...Jr(),...e.classNames}}},[e.locale,e.broadcastCalendar,e.weekStartsOn,e.firstWeekContainsDate,e.useAdditionalWeekYearTokens,e.useAdditionalDayOfYearTokens,e.timeZone,e.numerals,e.dateLib,e.noonSafe,e.components,e.formatters,e.labels,e.classNames]);e.today||(e={...e,today:l.today()});const{captionLayout:f,mode:m,navLayout:u,numberOfMonths:d=1,onDayBlur:h,onDayClick:b,onDayFocus:j,onDayKeyDown:N,onDayMouseEnter:w,onDayMouseLeave:D,onNextClick:v,onPrevClick:C,showWeekNumber:p,styles:y}=e,{formatCaption:x,formatDay:M,formatMonthDropdown:_,formatWeekNumber:I,formatWeekNumberHeader:F,formatWeekdayName:G,formatYearDropdown:U}=o,z=Po(e,l),{days:X,months:S,navStart:B,navEnd:q,previousMonth:$,nextMonth:Z,goToMonth:V}=z,ie=Vr(X,e,B,q,l),{isSelected:ee,select:re,selected:te}=$o(e,l)??{},{blur:me,focused:ce,isFocusTarget:he,moveFocus:de,setFocused:J}=To(e,z,ie,ee??(()=>!1),l),{labelDayButton:oe,labelGridcell:ke,labelGrid:pe,labelMonthDropdown:T,labelNav:se,labelPrevious:O,labelNext:P,labelWeekday:be,labelWeekNumber:vt,labelWeekNumberHeader:Ie,labelYearDropdown:Le}=i,ot=g.useMemo(()=>xo(l,e.ISOWeek,e.broadcastCalendar,e.today),[l,e.ISOWeek,e.broadcastCalendar,e.today]),Pe=m!==void 0||b!==void 0,Ae=g.useCallback(()=>{$&&(V($),C?.($))},[$,V,C]),at=g.useCallback(()=>{Z&&(V(Z),v?.(Z))},[V,Z,v]),Ze=g.useCallback((A,H)=>E=>{E.preventDefault(),E.stopPropagation(),J(A),!H.disabled&&(re?.(A.date,H,E),b?.(A.date,H,E))},[re,b,J]),Xe=g.useCallback((A,H)=>E=>{J(A),j?.(A.date,H,E)},[j,J]),it=g.useCallback((A,H)=>E=>{me(),h?.(A.date,H,E)},[me,h]),Be=g.useCallback((A,H)=>E=>{const R={ArrowLeft:[E.shiftKey?"month":"day",e.dir==="rtl"?"after":"before"],ArrowRight:[E.shiftKey?"month":"day",e.dir==="rtl"?"before":"after"],ArrowDown:[E.shiftKey?"year":"week","after"],ArrowUp:[E.shiftKey?"year":"week","before"],PageUp:[E.shiftKey?"year":"month","before"],PageDown:[E.shiftKey?"year":"month","after"],Home:["startOfWeek","before"],End:["endOfWeek","after"]};if(R[E.key]){E.preventDefault(),E.stopPropagation();const[le,Y]=R[E.key];de(le,Y)}N?.(A.date,H,E)},[de,N,e.dir]),Ye=g.useCallback((A,H)=>E=>{w?.(A.date,H,E)},[w]),Je=g.useCallback((A,H)=>E=>{D?.(A.date,H,E)},[D]),Ct=g.useCallback(A=>H=>{const E=Number(H.target.value),R=l.setMonth(l.startOfMonth(A),E);V(R)},[l,V]),Qe=g.useCallback(A=>H=>{const E=Number(H.target.value),R=l.setYear(l.startOfMonth(A),E);V(R)},[l,V]),{className:et,style:Re}=g.useMemo(()=>({className:[c[W.Root],e.className].filter(Boolean).join(" "),style:{...y?.[W.Root],...e.style}}),[c,e.className,e.style,y]),$e=Xr(e),We=g.useRef(null);jo(We,!!e.animate,{classNames:c,months:S,focused:ce,dateLib:l});const tt={dayPickerProps:e,selected:te,select:re,isSelected:ee,months:S,nextMonth:Z,previousMonth:$,goToMonth:V,getModifiers:ie,components:n,classNames:c,styles:y,labels:i,formatters:o};return k.createElement(js.Provider,{value:tt},k.createElement(n.Root,{rootRef:e.animate?We:void 0,className:et,style:Re,dir:e.dir,id:e.id,lang:e.lang,nonce:e.nonce,title:e.title,role:e.role,"aria-label":e["aria-label"],"aria-labelledby":e["aria-labelledby"],...$e},k.createElement(n.Months,{className:c[W.Months],style:y?.[W.Months]},!e.hideNavigation&&!u&&k.createElement(n.Nav,{"data-animated-nav":e.animate?"true":void 0,className:c[W.Nav],style:y?.[W.Nav],"aria-label":se(),onPreviousClick:Ae,onNextClick:at,previousMonth:$,nextMonth:Z}),S.map((A,H)=>k.createElement(n.Month,{"data-animated-month":e.animate?"true":void 0,className:c[W.Month],style:y?.[W.Month],key:H,displayIndex:H,calendarMonth:A},u==="around"&&!e.hideNavigation&&H===0&&k.createElement(n.PreviousMonthButton,{type:"button",className:c[W.PreviousMonthButton],tabIndex:$?void 0:-1,"aria-disabled":$?void 0:!0,"aria-label":O($),onClick:Ae,"data-animated-button":e.animate?"true":void 0},k.createElement(n.Chevron,{disabled:$?void 0:!0,className:c[W.Chevron],orientation:e.dir==="rtl"?"right":"left"})),k.createElement(n.MonthCaption,{"data-animated-caption":e.animate?"true":void 0,className:c[W.MonthCaption],style:y?.[W.MonthCaption],calendarMonth:A,displayIndex:H},f?.startsWith("dropdown")?k.createElement(n.DropdownNav,{className:c[W.Dropdowns],style:y?.[W.Dropdowns]},(()=>{const E=f==="dropdown"||f==="dropdown-months"?k.createElement(n.MonthsDropdown,{key:"month",className:c[W.MonthsDropdown],"aria-label":T(),classNames:c,components:n,disabled:!!e.disableNavigation,onChange:Ct(A.date),options:ho(A.date,B,q,o,l),style:y?.[W.Dropdown],value:l.getMonth(A.date)}):k.createElement("span",{key:"month"},_(A.date,l)),R=f==="dropdown"||f==="dropdown-years"?k.createElement(n.YearsDropdown,{key:"year",className:c[W.YearsDropdown],"aria-label":Le(l.options),classNames:c,components:n,disabled:!!e.disableNavigation,onChange:Qe(A.date),options:yo(B,q,o,l,!!e.reverseYears),style:y?.[W.Dropdown],value:l.getYear(A.date)}):k.createElement("span",{key:"year"},U(A.date,l));return l.getMonthYearOrder()==="year-first"?[R,E]:[E,R]})(),k.createElement("span",{role:"status","aria-live":"polite",style:{border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap",wordWrap:"normal"}},x(A.date,l.options,l))):k.createElement(n.CaptionLabel,{className:c[W.CaptionLabel],role:"status","aria-live":"polite"},x(A.date,l.options,l))),u==="around"&&!e.hideNavigation&&H===d-1&&k.createElement(n.NextMonthButton,{type:"button",className:c[W.NextMonthButton],tabIndex:Z?void 0:-1,"aria-disabled":Z?void 0:!0,"aria-label":P(Z),onClick:at,"data-animated-button":e.animate?"true":void 0},k.createElement(n.Chevron,{disabled:Z?void 0:!0,className:c[W.Chevron],orientation:e.dir==="rtl"?"left":"right"})),H===d-1&&u==="after"&&!e.hideNavigation&&k.createElement(n.Nav,{"data-animated-nav":e.animate?"true":void 0,className:c[W.Nav],style:y?.[W.Nav],"aria-label":se(),onPreviousClick:Ae,onNextClick:at,previousMonth:$,nextMonth:Z}),k.createElement(n.MonthGrid,{role:"grid","aria-multiselectable":m==="multiple"||m==="range","aria-label":pe(A.date,l.options,l)||void 0,className:c[W.MonthGrid],style:y?.[W.MonthGrid]},!e.hideWeekdays&&k.createElement(n.Weekdays,{"data-animated-weekdays":e.animate?"true":void 0,className:c[W.Weekdays],style:y?.[W.Weekdays]},p&&k.createElement(n.WeekNumberHeader,{"aria-label":Ie(l.options),className:c[W.WeekNumberHeader],style:y?.[W.WeekNumberHeader],scope:"col"},F()),ot.map(E=>k.createElement(n.Weekday,{"aria-label":be(E,l.options,l),className:c[W.Weekday],key:String(E),style:y?.[W.Weekday],scope:"col"},G(E,l.options,l)))),k.createElement(n.Weeks,{"data-animated-weeks":e.animate?"true":void 0,className:c[W.Weeks],style:y?.[W.Weeks]},A.weeks.map(E=>k.createElement(n.Week,{className:c[W.Week],key:E.weekNumber,style:y?.[W.Week],week:E},p&&k.createElement(n.WeekNumber,{week:E,style:y?.[W.WeekNumber],"aria-label":vt(E.weekNumber,{locale:a}),className:c[W.WeekNumber],scope:"row",role:"rowheader"},I(E.weekNumber,l)),E.days.map(R=>{const{date:le}=R,Y=ie(R);if(Y[ne.focused]=!Y.hidden&&!!ce?.isEqualTo(R),Y[je.selected]=ee?.(le)||Y.selected,wt(te)){const{from:L,to:qe}=te;Y[je.range_start]=!!(L&&qe&&l.isSameDay(le,L)),Y[je.range_end]=!!(L&&qe&&l.isSameDay(le,qe)),Y[je.range_middle]=Te(te,le,!0,l)}const He=po(Y,y,e.modifiersStyles),ze=Lr(Y,c,e.modifiersClassNames),st=!Pe&&!Y.hidden?ke(le,Y,l.options,l):void 0;return k.createElement(n.Day,{key:`${R.isoDate}_${R.displayMonthId}`,day:R,modifiers:Y,className:ze.join(" "),style:He,role:"gridcell","aria-selected":Y.selected||void 0,"aria-label":st,"data-day":R.isoDate,"data-month":R.outside?R.dateMonthId:void 0,"data-selected":Y.selected||void 0,"data-disabled":Y.disabled||void 0,"data-hidden":Y.hidden||void 0,"data-outside":R.outside||void 0,"data-focused":Y.focused||void 0,"data-today":Y.today||void 0},!Y.hidden&&Pe?k.createElement(n.DayButton,{className:c[W.DayButton],style:y?.[W.DayButton],type:"button",day:R,modifiers:Y,disabled:!Y.focused&&Y.disabled||void 0,"aria-disabled":Y.focused&&Y.disabled||void 0,tabIndex:he(R)?0:-1,"aria-label":oe(le,Y,l.options,l),onClick:Ze(R,Y),onBlur:it(R,Y),onFocus:Xe(R,Y),onKeyDown:Be(R,Y),onMouseEnter:Ye(R,Y),onMouseLeave:Je(R,Y)},M(le,l.options,l)):!Y.hidden&&M(R.date,l.options,l))})))))))),e.footer&&k.createElement(n.Footer,{className:c[W.Footer],style:y?.[W.Footer],role:"status","aria-live":"polite"},e.footer)))}function As(t){const e=_e.c(18);let r,n,o,i;e[0]!==t?({className:r,classNames:n,showOutsideDays:i,...o}=t,e[0]=t,e[1]=r,e[2]=n,e[3]=o,e[4]=i):(r=e[1],n=e[2],o=e[3],i=e[4]);const l=i===void 0?!0:i;let a;e[5]!==r?(a=Q("p-3",r),e[5]=r,e[6]=a):a=e[6];let c,f;e[7]===Symbol.for("react.memo_cache_sentinel")?(c=Q(Mt({variant:"outline"}),"absolute left-1 h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),f=Q(Mt({variant:"outline"}),"absolute right-1 h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),e[7]=c,e[8]=f):(c=e[7],f=e[8]);let m;e[9]===Symbol.for("react.memo_cache_sentinel")?(m=Q(Mt({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),e[9]=m):m=e[9];let u;e[10]!==n?(u={months:"flex flex-col sm:flex-row gap-4",month:"flex flex-col gap-4",month_caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",button_previous:c,button_next:f,month_grid:"w-full border-collapse space-y-1",weekdays:"flex",weekday:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",week:"flex w-full mt-2",day:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day_button:m,range_end:"day-range-end",selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",today:"bg-accent text-accent-foreground",outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",disabled:"text-muted-foreground opacity-50",range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",hidden:"invisible",...n},e[10]=n,e[11]=u):u=e[11];let d;e[12]===Symbol.for("react.memo_cache_sentinel")?(d={Chevron:zo},e[12]=d):d=e[12];let h;return e[13]!==o||e[14]!==l||e[15]!==a||e[16]!==u?(h=s.jsx(Ho,{showOutsideDays:l,className:a,classNames:u,components:d,...o}),e[13]=o,e[14]=l,e[15]=a,e[16]=u,e[17]=h):h=e[17],h}function zo(t){return t.orientation==="left"?s.jsx(xn,{className:"h-4 w-4"}):s.jsx(yn,{className:"h-4 w-4"})}As.displayName="Calendar";var St="Popover",[Bs,fi]=bn(St,[cs]),bt=cs(),[Uo,Ke]=Bs(St),Ys=t=>{const{__scopePopover:e,children:r,open:n,defaultOpen:o,onOpenChange:i,modal:l=!1}=t,a=bt(e),c=g.useRef(null),[f,m]=g.useState(!1),[u,d]=gn({prop:n,defaultProp:o??!1,onChange:i,caller:St});return s.jsx(Dn,{...a,children:s.jsx(Uo,{scope:e,contentId:vn(),triggerRef:c,open:u,onOpenChange:d,onOpenToggle:g.useCallback(()=>d(h=>!h),[d]),hasCustomAnchor:f,onCustomAnchorAdd:g.useCallback(()=>m(!0),[]),onCustomAnchorRemove:g.useCallback(()=>m(!1),[]),modal:l,children:r})})};Ys.displayName=St;var Rs="PopoverAnchor",Ko=g.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=Ke(Rs,r),i=bt(r),{onCustomAnchorAdd:l,onCustomAnchorRemove:a}=o;return g.useEffect(()=>(l(),()=>a()),[l,a]),s.jsx(ds,{...i,...n,ref:e})});Ko.displayName=Rs;var $s="PopoverTrigger",Hs=g.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=Ke($s,r),i=bt(r),l=os(e,o.triggerRef),a=s.jsx(fs.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":Gs(o.open),...n,ref:l,onClick:ut(t.onClick,o.onOpenToggle)});return o.hasCustomAnchor?a:s.jsx(ds,{asChild:!0,...i,children:a})});Hs.displayName=$s;var Ht="PopoverPortal",[qo,Go]=Bs(Ht,{forceMount:void 0}),zs=t=>{const{__scopePopover:e,forceMount:r,children:n,container:o}=t,i=Ke(Ht,e);return s.jsx(qo,{scope:e,forceMount:r,children:s.jsx(ls,{present:r||i.open,children:s.jsx(Nn,{asChild:!0,container:o,children:n})})})};zs.displayName=Ht;var rt="PopoverContent",Us=g.forwardRef((t,e)=>{const r=Go(rt,t.__scopePopover),{forceMount:n=r.forceMount,...o}=t,i=Ke(rt,t.__scopePopover);return s.jsx(ls,{present:n||i.open,children:i.modal?s.jsx(Lo,{...o,ref:e}):s.jsx(Zo,{...o,ref:e})})});Us.displayName=rt;var Vo=un("PopoverContent.RemoveScroll"),Lo=g.forwardRef((t,e)=>{const r=Ke(rt,t.__scopePopover),n=g.useRef(null),o=os(e,n),i=g.useRef(!1);return g.useEffect(()=>{const l=n.current;if(l)return jn(l)},[]),s.jsx(wn,{as:Vo,allowPinchZoom:!0,children:s.jsx(Ks,{...t,ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ut(t.onCloseAutoFocus,l=>{l.preventDefault(),i.current||r.triggerRef.current?.focus()}),onPointerDownOutside:ut(t.onPointerDownOutside,l=>{const a=l.detail.originalEvent,c=a.button===0&&a.ctrlKey===!0,f=a.button===2||c;i.current=f},{checkForDefaultPrevented:!1}),onFocusOutside:ut(t.onFocusOutside,l=>l.preventDefault(),{checkForDefaultPrevented:!1})})})}),Zo=g.forwardRef((t,e)=>{const r=Ke(rt,t.__scopePopover),n=g.useRef(!1),o=g.useRef(!1);return s.jsx(Ks,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{t.onCloseAutoFocus?.(i),i.defaultPrevented||(n.current||r.triggerRef.current?.focus(),i.preventDefault()),n.current=!1,o.current=!1},onInteractOutside:i=>{t.onInteractOutside?.(i),i.defaultPrevented||(n.current=!0,i.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const l=i.target;r.triggerRef.current?.contains(l)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&o.current&&i.preventDefault()}})}),Ks=g.forwardRef((t,e)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:i,disableOutsidePointerEvents:l,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:f,onInteractOutside:m,...u}=t,d=Ke(rt,r),h=bt(r);return kn(),s.jsx(Sn,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:o,onUnmountAutoFocus:i,children:s.jsx(Cn,{asChild:!0,disableOutsidePointerEvents:l,onInteractOutside:m,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:f,onDismiss:()=>d.onOpenChange(!1),children:s.jsx(Mn,{"data-state":Gs(d.open),role:"dialog",id:d.contentId,...h,...u,ref:e,style:{...u.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),qs="PopoverClose",Xo=g.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=Ke(qs,r);return s.jsx(fs.button,{type:"button",...n,ref:e,onClick:ut(t.onClick,()=>o.onOpenChange(!1))})});Xo.displayName=qs;var Jo="PopoverArrow",Qo=g.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=bt(r);return s.jsx(_n,{...o,...n,ref:e})});Qo.displayName=Jo;function Gs(t){return t?"open":"closed"}var ea=Ys,ta=Hs,sa=zs,na=Us;const ra=ea,oa=ta;function aa(t){const e=_e.c(12);let r,n,o,i;e[0]!==t?({className:r,align:o,sideOffset:i,...n}=t,e[0]=t,e[1]=r,e[2]=n,e[3]=o,e[4]=i):(r=e[1],n=e[2],o=e[3],i=e[4]);const l=o===void 0?"center":o,a=i===void 0?4:i;let c;e[5]!==r?(c=Q("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),e[5]=r,e[6]=c):c=e[6];let f;return e[7]!==l||e[8]!==n||e[9]!==a||e[10]!==c?(f=s.jsx(sa,{children:s.jsx(na,{"data-slot":"popover-content",align:l,sideOffset:a,className:c,...n})}),e[7]=l,e[8]=n,e[9]=a,e[10]=c,e[11]=f):f=e[11],f}const ia=[{value:"morning",label:"Morning",description:"6:00 AM - 12:00 PM"},{value:"afternoon",label:"Afternoon",description:"12:00 PM - 6:00 PM"},{value:"evening",label:"Evening",description:"6:00 PM - 9:00 PM"}];function la({userAddresses:t=[],googleMapsKey:e}){const{location:r,selectedDate:n,timeOfDay:o,setLocation:i,setSelectedDate:l,setTimeOfDay:a,setStep:c,goBack:f}=Ue(),[m,u]=g.useState(r?.postcode||""),[d,h]=g.useState(""),[b,j]=g.useState(!1),N=p=>/^[A-Z]{1,2}\d{1,2}[A-Z]?\s?\d[A-Z]{2}$/i.test(p.trim()),w=p=>{if(p==="new"){h("new"),u(""),i(null);return}const y=t.find(x=>x.id===p);y&&(h(p),u(y.postcode),D(y.postcode))},D=async p=>{if(!N(p)){K.error("Please enter a valid UK postcode");return}j(!0);try{const x=await(await fetch(`https://api.postcodes.io/postcodes/${encodeURIComponent(p)}`)).json();x.status===200&&x.result?(i({postcode:p.toUpperCase(),lat:x.result.latitude,lng:x.result.longitude,address:`${x.result.admin_district}, ${x.result.region}`}),K.success("Location found")):K.error("Postcode not found. Please check and try again.")}catch(y){console.error("Geocoding error:",y),K.error("Failed to find location. Please try again.")}finally{j(!1)}},v=()=>{if(!r){K.error("Please enter a valid postcode");return}if(!n){K.error("Please select a date");return}if(!o){K.error("Please select a time of day");return}c("provider")},C=p=>{const y=new Date;return y.setHours(0,0,0,0),p<y};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-semibold text-foreground mb-2",children:"Location & Schedule"}),s.jsx("p",{className:"text-muted-foreground",children:"When and where would you like your test?"})]}),t.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"saved-address",className:"text-sm font-medium text-foreground",children:"Saved Addresses"}),s.jsxs(mt,{value:d,onValueChange:w,children:[s.jsx(ht,{id:"saved-address",className:"h-12",children:s.jsx(pt,{placeholder:"Select a saved address or enter new"})}),s.jsxs(xt,{children:[t.map(p=>s.jsx(xe,{value:p.id,children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(Ve,{className:"w-4 h-4 mt-0.5 shrink-0 text-muted-foreground"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium",children:p.label}),s.jsxs("div",{className:"text-xs text-muted-foreground",children:[p.address_line1,", ",p.town_city,", ",p.postcode]})]})]})},p.id)),s.jsx(xe,{value:"new",children:s.jsx("div",{className:"font-medium",children:"Enter new postcode"})})]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{htmlFor:"postcode",className:"text-sm font-medium text-foreground",children:["Postcode ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(Ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),s.jsx("input",{id:"postcode",type:"text",placeholder:"e.g. SW1A 1AA",value:m,onChange:p=>u(p.target.value.toUpperCase()),className:"w-full h-12 pl-11 pr-4 bg-card border border-border rounded-xl text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),s.jsx(ae,{type:"button",onClick:()=>D(m),disabled:b||!m.trim(),className:"h-12 px-6",children:b?"Finding...":"Find"})]}),r&&s.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600 dark:text-green-400",children:[s.jsx(Ve,{className:"w-4 h-4"}),s.jsxs("span",{children:["Location confirmed: ",r.address||r.postcode]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"text-sm font-medium text-foreground",children:["Preferred Date ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsxs(ra,{children:[s.jsx(oa,{asChild:!0,children:s.jsxs(ae,{variant:"outline",className:Q("w-full h-12 justify-start text-left font-normal",!n&&"text-muted-foreground"),children:[s.jsx(ts,{className:"mr-2 h-4 w-4"}),n?De(n,"PPP"):s.jsx("span",{children:"Pick a date"})]})}),s.jsx(aa,{className:"w-auto p-0",align:"start",children:s.jsx(As,{mode:"single",selected:n||void 0,onSelect:p=>p&&l(p),disabled:C,initialFocus:!0})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"text-sm font-medium text-foreground",children:["Time of Day ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:ia.map(p=>s.jsx("button",{type:"button",onClick:()=>a(p.value),className:Q("p-4 rounded-xl border-2 transition-all text-left",o===p.value?"border-primary bg-primary/5":"border-border hover:border-primary/50"),children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:Q("w-10 h-10 rounded-lg flex items-center justify-center shrink-0",o===p.value?"bg-primary":"bg-muted"),children:s.jsx(On,{className:Q("w-5 h-5",o===p.value?"text-primary-foreground":"text-foreground")})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-foreground",children:p.label}),s.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:p.description})]})]})},p.value))})]}),s.jsx("div",{className:"p-4 bg-accent/30 rounded-xl border border-border",children:s.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.jsx("strong",{className:"text-foreground",children:"Note:"})," Exact time slots will be shown in the next step based on provider availability."]})}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[s.jsx(ae,{type:"button",variant:"outline",onClick:f,className:"sm:w-auto w-full py-6",children:"Back"}),s.jsx(ae,{onClick:v,disabled:!r||!n||!o,className:"flex-1 py-6 text-base",size:"lg",children:"Continue to Provider Selection"})]})]})}function ca({googleMapsKey:t}){const{location:e,selectedDate:r,timeOfDay:n,selectedServices:o,collectionType:i,selectedProvider:l,setSelectedProvider:a,setStep:c,goBack:f}=Ue(),{searchProviders:m}=It(),[u,d]=g.useState([]),[h,b]=g.useState([]),[j,N]=g.useState(!0),[w,D]=g.useState(""),[v,C]=g.useState("distance"),[p,y]=g.useState(10),[x,M]=g.useState(0),[_,I]=g.useState(!1),[F,G]=g.useState(null);g.useEffect(()=>{if(!e||!r)return;(async()=>{N(!0);try{const B=o.map(Z=>Z.id),q=De(r,"yyyy-MM-dd"),$=await m({lat:e.lat,lng:e.lng,service_ids:B,collection_type:i||void 0,date:q,radius_km:p});d($),b($)}catch(B){K.error("Failed to load providers"),console.error("Error loading providers:",B)}finally{N(!1)}})()},[e,r,i,o,p]),g.useEffect(()=>{let S=[...u];if(w.trim()){const B=w.toLowerCase();S=S.filter(q=>q.user.full_name.toLowerCase().includes(B)||q.provider_name?.toLowerCase().includes(B)||q.bio?.toLowerCase().includes(B))}x>0&&(S=S.filter(B=>B.average_rating>=x)),S.sort((B,q)=>{switch(v){case"distance":return(B.distance_km||0)-(q.distance_km||0);case"rating":return q.average_rating-B.average_rating;case"price_low":return U(B)-U(q);case"price_high":return U(q)-U(B);default:return 0}}),b(S)},[u,w,v,x]);const U=S=>!S.provider_services||S.provider_services.length===0?0:S.provider_services.reduce((B,q)=>B+q.base_cost,0),z=S=>{a(S)},X=()=>{if(!l){K.error("Please select a provider");return}c("patient")};return j?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-semibold text-foreground mb-2",children:"Select Provider"}),s.jsxs("p",{className:"text-muted-foreground",children:["Found ",h.length," provider",h.length!==1?"s":""," in your area"]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(as,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),s.jsx(Ce,{type:"text",placeholder:"Search providers...",value:w,onChange:S=>D(S.target.value),className:"pl-10"})]}),s.jsx(ae,{type:"button",variant:"outline",onClick:()=>I(!_),className:"px-4","aria-label":_?"Hide filters":"Show filters","aria-expanded":_,children:s.jsx(Fn,{className:"w-4 h-4"})})]}),_&&s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 p-4 bg-accent/30 rounded-xl border border-border",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-xs font-medium text-foreground",children:"Sort By"}),s.jsxs(mt,{value:v,onValueChange:S=>C(S),children:[s.jsx(ht,{className:"h-10",children:s.jsx(pt,{})}),s.jsxs(xt,{children:[s.jsx(xe,{value:"distance",children:"Distance"}),s.jsx(xe,{value:"rating",children:"Rating"}),s.jsx(xe,{value:"price_low",children:"Price: Low to High"}),s.jsx(xe,{value:"price_high",children:"Price: High to Low"})]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-xs font-medium text-foreground",children:"Max Distance (km)"}),s.jsxs(mt,{value:p.toString(),onValueChange:S=>y(Number(S)),children:[s.jsx(ht,{className:"h-10",children:s.jsx(pt,{})}),s.jsxs(xt,{children:[s.jsx(xe,{value:"5",children:"5 km"}),s.jsx(xe,{value:"10",children:"10 km"}),s.jsx(xe,{value:"20",children:"20 km"}),s.jsx(xe,{value:"50",children:"50 km"})]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-xs font-medium text-foreground",children:"Min Rating"}),s.jsxs(mt,{value:x.toString(),onValueChange:S=>M(Number(S)),children:[s.jsx(ht,{className:"h-10",children:s.jsx(pt,{})}),s.jsxs(xt,{children:[s.jsx(xe,{value:"0",children:"All Ratings"}),s.jsx(xe,{value:"3",children:"3+ Stars"}),s.jsx(xe,{value:"4",children:"4+ Stars"}),s.jsx(xe,{value:"4.5",children:"4.5+ Stars"})]})]})]})]})]}),h.length===0?s.jsxs("div",{className:"text-center py-12 bg-card border border-border rounded-xl",children:[s.jsx(Ve,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"No providers found"}),s.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Try adjusting your filters or increasing the search radius"}),s.jsx(ae,{type:"button",variant:"outline",onClick:()=>y(20),children:"Increase Search Radius"})]}):s.jsx("div",{className:"space-y-3",children:h.map(S=>{const B=l?.id===S.id,q=U(S);return s.jsx("div",{className:Q("p-4 rounded-xl border-2 transition-all cursor-pointer",B?"border-primary bg-primary/5":"border-border hover:border-primary/50"),onClick:()=>z(S),children:s.jsxs("div",{className:"flex items-start gap-4",children:[S.show_image_in_search&&S.user.profile_image?s.jsx("img",{src:S.user.profile_image,alt:S.user.full_name,className:"w-16 h-16 rounded-full object-cover shrink-0"}):s.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:s.jsx("span",{className:"text-xl font-semibold text-primary",children:S.user.full_name.charAt(0)})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-foreground",children:S.user.full_name}),s.jsx("p",{className:"text-sm text-muted-foreground",children:S.type.name})]}),s.jsxs("div",{className:"text-right shrink-0",children:[s.jsxs("div",{className:"text-lg font-bold text-primary",children:["£",q.toFixed(2)]}),s.jsx("div",{className:"text-xs text-muted-foreground",children:"total"})]})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-muted-foreground mb-2",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(zt,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"}),s.jsx("span",{className:"font-medium text-foreground",children:S.average_rating.toFixed(1)}),s.jsxs("span",{children:["(",S.total_reviews,")"]})]}),S.distance_km!==void 0&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(Ve,{className:"w-4 h-4"}),s.jsxs("span",{children:[S.distance_km.toFixed(1)," km away"]})]}),S.experience_years&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(Ut,{className:"w-4 h-4"}),s.jsxs("span",{children:[S.experience_years,"+ years"]})]})]}),S.bio&&s.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 mb-2",children:S.bio}),s.jsx("button",{type:"button",onClick:$=>{$.stopPropagation(),G(S)},className:"text-sm text-primary hover:underline",children:"View Details"})]})]})},S.id)})}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[s.jsx(ae,{type:"button",variant:"outline",onClick:f,className:"sm:w-auto w-full py-6",children:"Back"}),s.jsx(ae,{onClick:X,disabled:!l,className:"flex-1 py-6 text-base",size:"lg",children:"Continue to Patient Details"})]}),s.jsx(Pn,{open:!!F,onOpenChange:()=>G(null),children:s.jsx(Wn,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:F&&s.jsxs(s.Fragment,{children:[s.jsx(En,{children:s.jsx(Tn,{children:F.user.full_name})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-start gap-4",children:[F.user.profile_image?s.jsx("img",{src:F.user.profile_image,alt:F.user.full_name,className:"w-24 h-24 rounded-full object-cover shrink-0"}):s.jsx("div",{className:"w-24 h-24 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:s.jsx("span",{className:"text-3xl font-semibold text-primary",children:F.user.full_name.charAt(0)})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:F.type.name}),s.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(zt,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"}),s.jsx("span",{className:"font-medium",children:F.average_rating.toFixed(1)}),s.jsxs("span",{className:"text-muted-foreground",children:["(",F.total_reviews," reviews)"]})]}),F.experience_years&&s.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[s.jsx(Ut,{className:"w-4 h-4"}),s.jsxs("span",{children:[F.experience_years,"+ years experience"]})]})]})]})]}),F.bio&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-foreground mb-2",children:"About"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:F.bio})]}),F.provider_services&&F.provider_services.length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-foreground mb-2",children:"Services & Pricing"}),s.jsx("div",{className:"space-y-2",children:F.provider_services.map(S=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-accent/30 rounded-lg",children:[s.jsx("span",{className:"text-sm text-foreground",children:S.service.service_name}),s.jsxs("span",{className:"text-sm font-medium text-foreground",children:["£",S.base_cost.toFixed(2)]})]},S.id))})]}),s.jsx("div",{className:"pt-4",children:s.jsx(ae,{onClick:()=>{z(F),G(null)},className:"w-full",children:"Select This Provider"})})]})]})})})]})}function da(t){const e=_e.c(107),{userData:r,userAddresses:n}=t;let o;e[0]!==n?(o=n===void 0?[]:n,e[0]=n,e[1]=o):o=e[1];const i=o,{patientDetails:l,isNhsTest:a,setPatientDetails:c,setStep:f,goBack:m}=Ue();let u;e[2]===Symbol.for("react.memo_cache_sentinel")?(u={firstName:"",lastName:"",email:"",phone:"",dateOfBirth:"",nhsNumber:"",isUnder16:!1,guardianName:"",guardianConfirmed:!1,notes:""},e[2]=u):u=e[2];const[d,h]=g.useState(u),[b,j]=g.useState("");let N,w;e[3]!==l||e[4]!==i||e[5]!==r?(N=()=>{if(l)h(l);else if(r){const[qe,...Dt]=r.name.split(" ");h(Vs=>({...Vs,firstName:qe||"",lastName:Dt.join(" ")||"",email:r.email||"",phone:r.phone||""}))}const L=i.find(xa);L&&j(L.id)},w=[l,r,i],e[3]=l,e[4]=i,e[5]=r,e[6]=N,e[7]=w):(N=e[6],w=e[7]),g.useEffect(N,w);let D;e[8]===Symbol.for("react.memo_cache_sentinel")?(D=(L,qe)=>{h(Dt=>({...Dt,[L]:qe}))},e[8]=D):D=e[8];const v=D;let C;e[9]===Symbol.for("react.memo_cache_sentinel")?(C=L=>{j(L)},e[9]=C):C=e[9];const p=C,y=pa,x=ha,M=ma,_=ua;let I;e[10]!==d||e[11]!==a||e[12]!==c||e[13]!==f?(I=()=>{if(!d.firstName.trim()){K.error("Please enter first name");return}if(!d.lastName.trim()){K.error("Please enter last name");return}if(!y(d.email)){K.error("Please enter a valid email address");return}if(!x(d.phone)){K.error("Please enter a valid UK phone number");return}if(!_(d.dateOfBirth)){K.error("Please enter a valid date of birth");return}if(a&&!M(d.nhsNumber||"")){K.error("Please enter a valid 10-digit NHS number");return}if(d.isUnder16){if(!d.guardianName?.trim()){K.error("Please enter guardian name");return}if(!d.guardianConfirmed){K.error("Please confirm parental responsibility");return}}c(d),f("payment")},e[10]=d,e[11]=a,e[12]=c,e[13]=f,e[14]=I):I=e[14];const F=I;let G;e[15]!==d.dateOfBirth||e[16]!==d.email||e[17]!==d.firstName||e[18]!==d.lastName||e[19]!==d.phone?(G=d.firstName.trim()&&d.lastName.trim()&&y(d.email)&&x(d.phone)&&_(d.dateOfBirth),e[15]=d.dateOfBirth,e[16]=d.email,e[17]=d.firstName,e[18]=d.lastName,e[19]=d.phone,e[20]=G):G=e[20];const U=G;let z;e[21]!==d.nhsNumber||e[22]!==a?(z=!a||M(d.nhsNumber||""),e[21]=d.nhsNumber,e[22]=a,e[23]=z):z=e[23];const X=z;let S;e[24]!==d.guardianConfirmed||e[25]!==d.guardianName||e[26]!==d.isUnder16?(S=!d.isUnder16||d.guardianName?.trim()&&d.guardianConfirmed,e[24]=d.guardianConfirmed,e[25]=d.guardianName,e[26]=d.isUnder16,e[27]=S):S=e[27];const q=U&&X&&S;let $;e[28]===Symbol.for("react.memo_cache_sentinel")?($=s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-semibold text-foreground mb-2",children:"Patient Details"}),s.jsx("p",{className:"text-muted-foreground",children:"Please provide your information"})]}),e[28]=$):$=e[28];let Z;e[29]===Symbol.for("react.memo_cache_sentinel")?(Z=L=>v("isUnder16",L===!0),e[29]=Z):Z=e[29];let V;e[30]!==d.isUnder16?(V=s.jsx(Nt,{id:"under-16",checked:d.isUnder16,onCheckedChange:Z}),e[30]=d.isUnder16,e[31]=V):V=e[31];let ie;e[32]===Symbol.for("react.memo_cache_sentinel")?(ie=s.jsx("label",{htmlFor:"under-16",className:"text-sm text-foreground cursor-pointer flex-1",children:"Patient is under 16 years old"}),e[32]=ie):ie=e[32];let ee;e[33]!==V?(ee=s.jsxs("div",{className:"flex items-center gap-3 p-4 bg-accent/30 rounded-xl border border-border",children:[V,ie]}),e[33]=V,e[34]=ee):ee=e[34];let re;e[35]!==d.guardianConfirmed||e[36]!==d.guardianName||e[37]!==d.isUnder16?(re=d.isUnder16&&s.jsxs("div",{className:"space-y-4 p-4 bg-accent/30 rounded-xl border border-border",children:[s.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Guardian Information"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{htmlFor:"guardian-name",className:"text-sm font-medium text-foreground",children:["Guardian Name (Adult with Parental Responsibility) ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(Ce,{id:"guardian-name",type:"text",value:d.guardianName||"",onChange:L=>v("guardianName",L.target.value),placeholder:"Full name"})]}),s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Nt,{id:"guardian-confirm",checked:d.guardianConfirmed||!1,onCheckedChange:L=>v("guardianConfirmed",L===!0),className:"mt-0.5"}),s.jsx("label",{htmlFor:"guardian-confirm",className:"text-sm text-muted-foreground cursor-pointer",children:"I confirm that I have parental responsibility for this child and will be present at the blood draw. (We will need to check your ID)"})]})]}),e[35]=d.guardianConfirmed,e[36]=d.guardianName,e[37]=d.isUnder16,e[38]=re):re=e[38];let te;e[39]===Symbol.for("react.memo_cache_sentinel")?(te=s.jsxs("label",{htmlFor:"first-name",className:"text-sm font-medium text-foreground",children:["First Name ",s.jsx("span",{className:"text-destructive",children:"*"})]}),e[39]=te):te=e[39];const me=d.firstName;let ce;e[40]===Symbol.for("react.memo_cache_sentinel")?(ce=L=>v("firstName",L.target.value),e[40]=ce):ce=e[40];let he;e[41]!==d.firstName?(he=d.firstName.trim(),e[41]=d.firstName,e[42]=he):he=e[42];const de=!he;let J;e[43]!==d.firstName||e[44]!==de?(J=s.jsxs("div",{className:"space-y-2",children:[te,s.jsx(Ce,{id:"first-name",type:"text",value:me,onChange:ce,placeholder:"John","aria-required":"true","aria-invalid":de})]}),e[43]=d.firstName,e[44]=de,e[45]=J):J=e[45];let oe;e[46]===Symbol.for("react.memo_cache_sentinel")?(oe=s.jsxs("label",{htmlFor:"last-name",className:"text-sm font-medium text-foreground",children:["Last Name ",s.jsx("span",{className:"text-destructive",children:"*"})]}),e[46]=oe):oe=e[46];const ke=d.lastName;let pe;e[47]===Symbol.for("react.memo_cache_sentinel")?(pe=L=>v("lastName",L.target.value),e[47]=pe):pe=e[47];let T;e[48]!==d.lastName?(T=d.lastName.trim(),e[48]=d.lastName,e[49]=T):T=e[49];const se=!T;let O;e[50]!==d.lastName||e[51]!==se?(O=s.jsxs("div",{className:"space-y-2",children:[oe,s.jsx(Ce,{id:"last-name",type:"text",value:ke,onChange:pe,placeholder:"Smith","aria-required":"true","aria-invalid":se})]}),e[50]=d.lastName,e[51]=se,e[52]=O):O=e[52];let P;e[53]!==J||e[54]!==O?(P=s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[J,O]}),e[53]=J,e[54]=O,e[55]=P):P=e[55];let be;e[56]===Symbol.for("react.memo_cache_sentinel")?(be=s.jsxs("label",{htmlFor:"email",className:"text-sm font-medium text-foreground",children:["Email Address ",s.jsx("span",{className:"text-destructive",children:"*"})]}),e[56]=be):be=e[56];const vt=d.email;let Ie;e[57]===Symbol.for("react.memo_cache_sentinel")?(Ie=L=>v("email",L.target.value),e[57]=Ie):Ie=e[57];let Le;e[58]!==d.email?(Le=y(d.email),e[58]=d.email,e[59]=Le):Le=e[59];const ot=!Le;let Pe;e[60]!==d.email||e[61]!==ot?(Pe=s.jsxs("div",{className:"space-y-2",children:[be,s.jsx(Ce,{id:"email",type:"email",value:vt,onChange:Ie,placeholder:"john.smith@example.com","aria-required":"true","aria-invalid":ot})]}),e[60]=d.email,e[61]=ot,e[62]=Pe):Pe=e[62];let Ae;e[63]===Symbol.for("react.memo_cache_sentinel")?(Ae=s.jsxs("label",{htmlFor:"phone",className:"text-sm font-medium text-foreground",children:["Phone Number ",s.jsx("span",{className:"text-destructive",children:"*"})]}),e[63]=Ae):Ae=e[63];const at=d.phone;let Ze;e[64]===Symbol.for("react.memo_cache_sentinel")?(Ze=L=>v("phone",L.target.value),e[64]=Ze):Ze=e[64];let Xe;e[65]!==d.phone?(Xe=x(d.phone),e[65]=d.phone,e[66]=Xe):Xe=e[66];const it=!Xe;let Be;e[67]!==d.phone||e[68]!==it?(Be=s.jsxs("div",{className:"space-y-2",children:[Ae,s.jsx(Ce,{id:"phone",type:"tel",value:at,onChange:Ze,placeholder:"07XXX XXXXXX","aria-required":"true","aria-invalid":it})]}),e[67]=d.phone,e[68]=it,e[69]=Be):Be=e[69];let Ye;e[70]!==Pe||e[71]!==Be?(Ye=s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[Pe,Be]}),e[70]=Pe,e[71]=Be,e[72]=Ye):Ye=e[72];let Je;e[73]===Symbol.for("react.memo_cache_sentinel")?(Je=s.jsxs("label",{htmlFor:"dob",className:"text-sm font-medium text-foreground",children:["Date of Birth ",s.jsx("span",{className:"text-destructive",children:"*"})]}),e[73]=Je):Je=e[73];const Ct=d.dateOfBirth;let Qe,et;e[74]===Symbol.for("react.memo_cache_sentinel")?(Qe=L=>v("dateOfBirth",L.target.value),et=new Date().toISOString().split("T"),e[74]=Qe,e[75]=et):(Qe=e[74],et=e[75]);let Re;e[76]!==d.dateOfBirth?(Re=s.jsxs("div",{className:"space-y-2",children:[Je,s.jsx(Ce,{id:"dob",type:"date",value:Ct,onChange:Qe,max:et[0]})]}),e[76]=d.dateOfBirth,e[77]=Re):Re=e[77];let $e;e[78]!==d.nhsNumber||e[79]!==a?($e=a&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{htmlFor:"nhs-number",className:"text-sm font-medium text-foreground",children:["NHS Number ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(Ce,{id:"nhs-number",type:"text",value:d.nhsNumber||"",onChange:L=>v("nhsNumber",L.target.value.replace(/\D/g,"").slice(0,10)),placeholder:"1234567890",maxLength:10}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter your 10-digit NHS number"})]}),e[78]=d.nhsNumber,e[79]=a,e[80]=$e):$e=e[80];let We;e[81]!==b||e[82]!==i?(We=i.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"saved-address",className:"text-sm font-medium text-foreground",children:"Saved Addresses"}),s.jsxs(mt,{value:b,onValueChange:p,children:[s.jsx(ht,{id:"saved-address",children:s.jsx(pt,{placeholder:"Select address or skip"})}),s.jsx(xt,{children:i.map(fa)})]})]}),e[81]=b,e[82]=i,e[83]=We):We=e[83];let tt;e[84]===Symbol.for("react.memo_cache_sentinel")?(tt=s.jsx("label",{htmlFor:"notes",className:"text-sm font-medium text-foreground",children:"Special Instructions (Optional)"}),e[84]=tt):tt=e[84];const A=d.notes||"";let H;e[85]===Symbol.for("react.memo_cache_sentinel")?(H=L=>v("notes",L.target.value),e[85]=H):H=e[85];let E;e[86]!==A?(E=s.jsxs("div",{className:"space-y-2",children:[tt,s.jsx(In,{id:"notes",value:A,onChange:H,placeholder:"Please tell us anything else we might need to know about your requirements including: details about specific collection(s), availability or accessibility restrictions, or previous problems you may have had having your blood taken.",rows:4,className:"resize-none"})]}),e[86]=A,e[87]=E):E=e[87];let R;e[88]===Symbol.for("react.memo_cache_sentinel")?(R=s.jsx("div",{className:"p-4 bg-accent/30 rounded-xl border border-border",children:s.jsx("p",{className:"text-sm text-muted-foreground",children:"By continuing, you agree to our terms of service and consent to the collection and processing of your personal data for the purpose of this blood test appointment."})}),e[88]=R):R=e[88];let le;e[89]!==m?(le=s.jsx(ae,{type:"button",variant:"outline",onClick:m,className:"sm:w-auto w-full py-6",children:"Back"}),e[89]=m,e[90]=le):le=e[90];const Y=!q;let He;e[91]!==F||e[92]!==Y?(He=s.jsx(ae,{onClick:F,disabled:Y,className:"flex-1 py-6 text-base",size:"lg",children:"Continue to Payment"}),e[91]=F,e[92]=Y,e[93]=He):He=e[93];let ze;e[94]!==le||e[95]!==He?(ze=s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[le,He]}),e[94]=le,e[95]=He,e[96]=ze):ze=e[96];let st;return e[97]!==ee||e[98]!==re||e[99]!==P||e[100]!==Ye||e[101]!==Re||e[102]!==$e||e[103]!==We||e[104]!==E||e[105]!==ze?(st=s.jsxs("div",{className:"space-y-6",children:[$,ee,re,P,Ye,Re,$e,We,E,R,ze]}),e[97]=ee,e[98]=re,e[99]=P,e[100]=Ye,e[101]=Re,e[102]=$e,e[103]=We,e[104]=E,e[105]=ze,e[106]=st):st=e[106],st}function fa(t){return s.jsx(xe,{value:t.id,children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(Ve,{className:"w-4 h-4 mt-0.5 shrink-0 text-muted-foreground"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium",children:t.label}),s.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.address_line1,", ",t.town_city,", ",t.postcode]})]})]})},t.id)}function ua(t){return t?new Date(t)<new Date:!1}function ma(t){return/^\d{10}$/.test(t.replace(/\s/g,""))}function ha(t){return/^(\+44\s?7\d{3}|\(?07\d{3}\)?)\s?\d{3}\s?\d{3}$/.test(t.replace(/\s/g,""))}function pa(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}function xa(t){return t.is_default}function ya({amount:t,onPaymentSuccess:e,onPaymentError:r}){const n=en(),o=tn(),[i,l]=g.useState(!1),a=async c=>{if(c.preventDefault(),!(!n||!o)){l(!0);try{const{error:f,paymentIntent:m}=await n.confirmPayment({elements:o,confirmParams:{return_url:`${window.location.origin}/book/success`},redirect:"if_required"});f?(r(f.message||"Payment failed"),K.error(f.message||"Payment failed")):m&&m.status==="succeeded"&&(e(m.id),K.success("Payment successful"))}catch(f){console.error("Payment error:",f),r("An unexpected error occurred"),K.error("An unexpected error occurred")}finally{l(!1)}}};return s.jsxs("form",{onSubmit:a,className:"space-y-4",children:[s.jsx(sn,{}),s.jsx(ae,{type:"submit",disabled:!n||i,className:"w-full py-6 text-base",size:"lg",children:i?s.jsxs(s.Fragment,{children:[s.jsx(us,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):`Pay £${t.toFixed(2)}`}),s.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Your payment is secured by Stripe. We never store your card details."})]})}function ga(t){const e=_e.c(15),{clientSecret:r,amount:n,stripePublicKey:o,onPaymentSuccess:i,onPaymentError:l}=t,[a,c]=g.useState(null);let f,m;if(e[0]!==o?(f=()=>{o&&c(Js(o))},m=[o],e[0]=o,e[1]=f,e[2]=m):(f=e[1],m=e[2]),g.useEffect(f,m),!a||!r){let N;return e[3]===Symbol.for("react.memo_cache_sentinel")?(N=s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx(us,{className:"h-6 w-6 animate-spin text-primary"})}),e[3]=N):N=e[3],N}let u;e[4]===Symbol.for("react.memo_cache_sentinel")?(u={theme:"stripe",variables:{colorPrimary:"hsl(var(--primary))",colorBackground:"hsl(var(--background))",colorText:"hsl(var(--foreground))",colorDanger:"hsl(var(--destructive))",fontFamily:"system-ui, sans-serif",borderRadius:"0.75rem"}},e[4]=u):u=e[4];let d;e[5]!==r?(d={clientSecret:r,appearance:u},e[5]=r,e[6]=d):d=e[6];const h=d;let b;e[7]!==n||e[8]!==l||e[9]!==i?(b=s.jsx(ya,{amount:n,onPaymentSuccess:i,onPaymentError:l}),e[7]=n,e[8]=l,e[9]=i,e[10]=b):b=e[10];let j;return e[11]!==h||e[12]!==a||e[13]!==b?(j=s.jsx(Qs,{stripe:a,options:h,children:b}),e[11]=h,e[12]=a,e[13]=b,e[14]=j):j=e[14],j}function ba({stripePublicKey:t,userPaymentMethods:e=[]}){const{selectedServices:r,collectionType:n,location:o,selectedDate:i,timeOfDay:l,selectedProvider:a,patientDetails:c,draftId:f,paymentIntentClientSecret:m,promoCode:u,discount:d,setDraftId:h,setPaymentIntentClientSecret:b,setPromoCode:j,setDiscount:N,setStep:w,goBack:D,clearBooking:v}=Ue(),{createDraft:C,createPaymentIntent:p,applyPromoCode:y,confirmBooking:x}=It(),{serviceFeePercentage:M,vatPercentage:_}=Qt().props,[I,F]=g.useState(""),[G,U]=g.useState(e.length===0),[z,X]=g.useState(u||""),[S,B]=g.useState(!1),[q,$]=g.useState(!1),[Z,V]=g.useState(!1),[ie,ee]=g.useState(!1);g.useEffect(()=>{if(e.length>0&&!I){const T=e.find(se=>se.is_default);T&&(F(T.id),U(!1))}},[e]),g.useEffect(()=>{!f&&i&&o&&c&&re()},[]);const re=async()=>{if(!(!i||!o||!c))try{const T=await C({collection_type:n||"home_visit",is_nhs_test:!1,service_ids:r.map(se=>se.id),location:o,selected_date:De(i,"yyyy-MM-dd"),time_of_day:l||void 0,provider_id:a?.id,patient_details:c});h(T.id),await te(T.id)}catch(T){console.error("Error creating draft:",T),K.error("Failed to prepare payment. Please try again.")}},te=async T=>{V(!0);try{const{clientSecret:se}=await p(T);b(se)}catch(se){console.error("Error creating payment intent:",se),K.error("Failed to initialize payment. Please try again.")}finally{V(!1)}},me=async()=>{if(!z.trim()||!f){K.error("Please enter a promo code");return}B(!0);try{const T=await y(f,z.trim());j(T.code),N(T.discount),K.success(`Promo code applied! £${T.discount.toFixed(2)} discount`)}catch(T){K.error(T.message||"Invalid promo code")}finally{B(!1)}},ce=async T=>{if(!f){K.error("Booking information missing");return}ee(!0);try{await x(T,f),K.success("Booking confirmed!"),w("success"),v()}catch(se){console.error("Error confirming booking:",se),K.error("Payment succeeded but booking confirmation failed. Please contact support.")}finally{ee(!1)}},he=T=>{console.error("Payment error:",T),K.error(T)},de=r.reduce((T,se)=>T+(se.base_price||0),0),J=de*(M/100),oe=(de+J)*(_/100),ke=de+J+oe,pe=d?ke-d:ke;return Z?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Preparing payment..."})]})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-semibold text-foreground mb-2",children:"Payment"}),s.jsx("p",{className:"text-muted-foreground",children:"Review your booking and complete payment"})]}),s.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 space-y-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Order Summary"}),a&&s.jsxs("div",{className:"flex items-center gap-3 pb-4 border-b border-border",children:[a.user.profile_image?s.jsx("img",{src:a.user.profile_image,alt:a.user.full_name,className:"w-12 h-12 rounded-full object-cover"}):s.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:s.jsx("span",{className:"text-lg font-semibold text-primary",children:a.user.full_name.charAt(0)})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-foreground",children:a.user.full_name}),s.jsx("p",{className:"text-sm text-muted-foreground",children:a.type.name})]})]}),s.jsxs("div",{className:"space-y-2 text-sm pb-4 border-b border-border",children:[i&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-muted-foreground",children:"Date & Time"}),s.jsxs("span",{className:"text-foreground",children:[De(i,"EEE, dd MMM yyyy")," • ",l]})]}),o&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-muted-foreground",children:"Location"}),s.jsx("span",{className:"text-foreground",children:o.postcode})]}),n&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-muted-foreground",children:"Collection Type"}),s.jsx("span",{className:"text-foreground capitalize",children:n.replace("_"," ")})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"text-sm font-medium text-foreground",children:"Selected Tests"}),r.map(T=>s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-foreground",children:T.service_name}),s.jsxs("span",{className:"font-medium text-foreground",children:["£",(T.base_price||0).toFixed(2)]})]},T.id))]}),s.jsxs("div",{className:"space-y-2 pt-4 border-t border-border",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),s.jsxs("span",{className:"text-foreground",children:["£",de.toFixed(2)]})]}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsxs("span",{className:"text-muted-foreground",children:["Service Fee (",M,"%)"]}),s.jsxs("span",{className:"text-foreground",children:["£",J.toFixed(2)]})]}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsxs("span",{className:"text-muted-foreground",children:["VAT (",_,"%)"]}),s.jsxs("span",{className:"text-foreground",children:["£",oe.toFixed(2)]})]}),d&&d>0&&s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Discount"}),s.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["-£",d.toFixed(2)]})]}),s.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t border-border",children:[s.jsx("span",{className:"text-foreground",children:"Total"}),s.jsxs("span",{className:"text-primary",children:["£",pe.toFixed(2)]})]})]})]}),!d&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-foreground",children:"Promo Code"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx($n,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),s.jsx(Ce,{type:"text",placeholder:"Enter code",value:z,onChange:T=>X(T.target.value.toUpperCase()),className:"pl-10"})]}),s.jsx(ae,{type:"button",variant:"outline",onClick:me,disabled:S||!z.trim(),children:S?"Applying...":"Apply"})]})]}),e.length>0&&!G&&s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{className:"text-sm font-medium text-foreground",children:"Saved Payment Methods"}),s.jsx("div",{className:"space-y-2",children:e.map(T=>s.jsx("button",{type:"button",onClick:()=>F(T.id),className:Q("w-full p-4 rounded-xl border-2 transition-all text-left",I===T.id?"border-primary bg-primary/5":"border-border hover:border-primary/50"),children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(An,{className:"w-5 h-5 text-muted-foreground"}),s.jsxs("div",{children:[s.jsxs("div",{className:"font-medium text-foreground capitalize",children:[T.card_brand," •••• ",T.card_last_four]}),s.jsxs("div",{className:"text-sm text-muted-foreground",children:["Expires ",T.card_exp_month,"/",T.card_exp_year]})]})]}),I===T.id&&s.jsx(ft,{className:"w-5 h-5 text-primary"})]})},T.id))}),s.jsx(ae,{type:"button",variant:"outline",onClick:()=>U(!0),className:"w-full",children:"Use a different card"})]}),(G||e.length===0)&&s.jsxs("div",{className:"space-y-4",children:[e.length>0&&s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:"text-sm font-medium text-foreground",children:"Card Details"}),s.jsx(ae,{type:"button",variant:"ghost",size:"sm",onClick:()=>U(!1),className:"text-xs",children:"Use saved card"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-4",children:[s.jsx(Bn,{className:"w-4 h-4"}),s.jsx("span",{children:"Secure payment powered by Stripe"})]}),m&&s.jsx(ga,{clientSecret:m,amount:pe,stripePublicKey:t,onPaymentSuccess:ce,onPaymentError:he})]}),s.jsxs("div",{className:"flex items-start gap-3 p-4 bg-accent/30 rounded-xl border border-border",children:[s.jsx(Nt,{id:"terms",checked:q,onCheckedChange:T=>$(T===!0),className:"mt-0.5"}),s.jsxs("label",{htmlFor:"terms",className:"text-sm text-muted-foreground cursor-pointer",children:["I accept the"," ",s.jsx("a",{href:"/terms",target:"_blank",className:"text-primary hover:underline",children:"terms and conditions"})," ","and"," ",s.jsx("a",{href:"/privacy",target:"_blank",className:"text-primary hover:underline",children:"privacy policy"})]})]}),!G&&e.length>0&&s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[s.jsx(ae,{type:"button",variant:"outline",onClick:D,className:"sm:w-auto w-full py-6",children:"Back"}),s.jsx(ae,{onClick:()=>{K.info("Saved payment method flow not yet implemented")},disabled:!q||!I||ie,className:"flex-1 py-6 text-base",size:"lg",children:ie?"Processing...":`Pay £${pe.toFixed(2)}`})]}),(G||e.length===0)&&s.jsx("div",{className:"pt-4",children:s.jsx(ae,{type:"button",variant:"outline",onClick:D,className:"w-full py-6",children:"Back"})})]})}function va(t){const e=_e.c(21),{pageProps:r}=t,{step:n,goToStep:o}=Ue();let i;e[0]!==r||e[1]!==n?(i=()=>{switch(n){case"collection":return s.jsx(Kt,{});case"location":return s.jsx(la,{userAddresses:r.userAddresses,googleMapsKey:r.googleMapsKey});case"provider":return s.jsx(ca,{googleMapsKey:r.googleMapsKey});case"patient":return s.jsx(da,{userData:r.userData,userAddresses:r.userAddresses});case"payment":return s.jsx(ba,{stripePublicKey:r.stripePublicKey||"",userPaymentMethods:r.userPaymentMethods});case"success":return s.jsx(Na,{});default:return s.jsx(Kt,{})}},e[0]=r,e[1]=n,e[2]=i):i=e[2];const l=i;let a;e[3]!==n?(a=n.charAt(0).toUpperCase(),e[3]=n,e[4]=a):a=e[4];const c=`Book Appointment - ${a+n.slice(1)}`;let f;e[5]!==c?(f=s.jsx(Ls,{title:c}),e[5]=c,e[6]=f):f=e[6];let m;e[7]!==o||e[8]!==n?(m=s.jsx("div",{className:"lg:block",children:s.jsx(zn,{currentStep:n,onStepClick:o})}),e[7]=o,e[8]=n,e[9]=m):m=e[9];let u;e[10]!==l?(u=s.jsx("main",{className:"max-w-3xl lg:mx-0 mx-auto",children:l()}),e[10]=l,e[11]=u):u=e[11];let d;e[12]!==n?(d=n!=="success"&&s.jsx("aside",{className:"hidden lg:block",children:s.jsx("div",{className:"sticky top-8",children:s.jsx(cr,{})})}),e[12]=n,e[13]=d):d=e[13];let h;e[14]!==m||e[15]!==u||e[16]!==d?(h=s.jsx("div",{className:"min-h-screen bg-background",children:s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsxs("div",{className:"lg:grid lg:grid-cols-[280px_1fr_320px] lg:gap-8",children:[m,u,d]})})}),e[14]=m,e[15]=u,e[16]=d,e[17]=h):h=e[17];let b;return e[18]!==f||e[19]!==h?(b=s.jsxs(s.Fragment,{children:[f,h]}),e[18]=f,e[19]=h,e[20]=b):b=e[20],b}function Na(){const t=_e.c(19),{selectedProvider:e,selectedDate:r,timeOfDay:n,location:o}=Ue();let i;t[0]===Symbol.for("react.memo_cache_sentinel")?(i=s.jsxs("div",{className:"mb-8",children:[s.jsx("div",{className:"w-20 h-20 rounded-full bg-green-100 dark:bg-green-900/20 flex items-center justify-center mx-auto mb-4",children:s.jsx(Yn,{className:"w-12 h-12 text-green-600 dark:text-green-400"})}),s.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Booking Confirmed!"}),s.jsx("p",{className:"text-lg text-muted-foreground",children:"Your appointment has been successfully booked"})]}),t[0]=i):i=t[0];let l;t[1]===Symbol.for("react.memo_cache_sentinel")?(l=s.jsx("h2",{className:"text-lg font-semibold text-foreground mb-4",children:"Appointment Details"}),t[1]=l):l=t[1];let a;t[2]!==e?(a=e&&s.jsxs("div",{className:"flex items-center gap-3 mb-4 pb-4 border-b border-border",children:[e.user.profile_image?s.jsx("img",{src:e.user.profile_image,alt:e.user.full_name,className:"w-12 h-12 rounded-full object-cover"}):s.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:s.jsx("span",{className:"text-lg font-semibold text-primary",children:e.user.full_name.charAt(0)})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-foreground",children:e.user.full_name}),s.jsx("p",{className:"text-sm text-muted-foreground",children:e.type.name})]})]}),t[2]=e,t[3]=a):a=t[3];let c;t[4]!==r||t[5]!==n?(c=r&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-muted-foreground",children:"Date & Time"}),s.jsxs("span",{className:"text-foreground font-medium",children:[r.toLocaleDateString("en-GB",{weekday:"short",day:"2-digit",month:"short",year:"numeric"})," ","• ",n]})]}),t[4]=r,t[5]=n,t[6]=c):c=t[6];let f;t[7]!==o?(f=o&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-muted-foreground",children:"Location"}),s.jsx("span",{className:"text-foreground font-medium",children:o.postcode})]}),t[7]=o,t[8]=f):f=t[8];let m;t[9]!==c||t[10]!==f?(m=s.jsxs("div",{className:"space-y-3",children:[c,f]}),t[9]=c,t[10]=f,t[11]=m):m=t[11];let u;t[12]!==a||t[13]!==m?(u=s.jsxs("div",{className:"bg-card border border-border rounded-2xl p-6 mb-8 text-left",children:[l,a,m]}),t[12]=a,t[13]=m,t[14]=u):u=t[14];let d;t[15]===Symbol.for("react.memo_cache_sentinel")?(d=s.jsx("div",{className:"bg-accent/30 border border-border rounded-xl p-4 mb-8",children:s.jsx("p",{className:"text-sm text-muted-foreground",children:"A confirmation email has been sent to your email address. You can manage this appointment from your dashboard."})}),t[15]=d):d=t[15];let h;t[16]===Symbol.for("react.memo_cache_sentinel")?(h=s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[s.jsx(ae,{onClick:wa,size:"lg",className:"px-8",children:"View Dashboard"}),s.jsx(ae,{onClick:ja,variant:"outline",size:"lg",className:"px-8",children:"Back to Home"})]}),t[16]=h):h=t[16];let b;return t[17]!==u?(b=s.jsxs("div",{className:"max-w-2xl mx-auto text-center py-12",children:[i,u,d,h]}),t[17]=u,t[18]=b):b=t[18],b}function ja(){return es.visit("/")}function wa(){return es.visit("/dashboard")}function ka(t){const e=_e.c(2);let r;return e[0]!==t?(r=s.jsx(Hn,{children:s.jsx(va,{pageProps:t})}),e[0]=t,e[1]=r):r=e[1],r}ka.layout=t=>s.jsx(Xs,{hideFooter:!0,children:t});export{ka as default};
