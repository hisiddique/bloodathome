import{c as F,a as G,j as s}from"./app-Bmo3up5q.js";import{r as _}from"./stripe-DEhpSmJl.js";import{B as Q}from"./button-DzSWANc3.js";import{I as U}from"./input-wNfwdC4B.js";import{X as W}from"./x-B1iQPaVG.js";import{S as Z}from"./send-BDGcIbj8.js";import{f as ee}from"./format-Dx8HDyBA.js";function ce(o){const e=F.c(52),{bookingId:l,phlebotomistName:n,phlebotomistImage:Y,onClose:z}=o,{auth:q}=G().props;let v;e[0]===Symbol.for("react.memo_cache_sentinel")?(v=[],e[0]=v):v=e[0];const[a,A]=_.useState(v),[r,J]=_.useState(""),[i,L]=_.useState(!1),V=_.useRef(null),D=q?.user?.id||null;let w,S;e[1]!==l?(w=()=>{const t=async()=>{try{const N=await fetch(`/api/bookings/${l}/messages`);if(N.ok){const X=await N.json();A(X)}}catch(N){console.error("Error fetching messages:",N)}};t();const T=setInterval(t,5e3);return()=>clearInterval(T)},S=[l],e[1]=l,e[2]=w,e[3]=S):(w=e[2],S=e[3]),_.useEffect(w,S);let k;e[4]===Symbol.for("react.memo_cache_sentinel")?(k=()=>{V.current?.scrollIntoView({behavior:"smooth"})},e[4]=k):k=e[4];let E;e[5]!==a?(E=[a],e[5]=a,e[6]=E):E=e[6],_.useEffect(k,E);let I;e[7]!==l||e[8]!==r||e[9]!==D?(I=async()=>{if(!(!r.trim()||!D)){L(!0);try{const t=await fetch(`/api/bookings/${l}/messages`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({message:r.trim(),sender_type:"patient"})});if(t.ok){const T=await t.json();A(N=>[...N,T]),J("")}}catch(t){console.error("Error sending message:",t)}L(!1)}},e[7]=l,e[8]=r,e[9]=D,e[10]=I):I=e[10];const c=I;let C;e[11]!==c?(C=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),c())},e[11]=c,e[12]=C):C=e[12];const H=C;let M;e[13]===Symbol.for("react.memo_cache_sentinel")?(M=s.jsx(W,{className:"w-5 h-5 text-foreground"}),e[13]=M):M=e[13];let d;e[14]!==z?(d=s.jsx("button",{onClick:z,className:"p-2 hover:bg-muted rounded-full transition-colors",children:M}),e[14]=z,e[15]=d):d=e[15];const O=Y||"/placeholder.svg";let m;e[16]!==n||e[17]!==O?(m=s.jsx("img",{src:O,alt:n,className:"w-10 h-10 rounded-full object-cover"}),e[16]=n,e[17]=O,e[18]=m):m=e[18];let f;e[19]!==n?(f=s.jsx("h3",{className:"font-semibold text-foreground",children:n}),e[19]=n,e[20]=f):f=e[20];let $;e[21]===Symbol.for("react.memo_cache_sentinel")?($=s.jsx("p",{className:"text-xs text-muted-foreground",children:"Your Phlebotomist"}),e[21]=$):$=e[21];let p;e[22]!==f?(p=s.jsxs("div",{className:"flex-1",children:[f,$]}),e[22]=f,e[23]=p):p=e[23];let u;e[24]!==m||e[25]!==p||e[26]!==d?(u=s.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-border bg-card",children:[d,m,p]}),e[24]=m,e[25]=p,e[26]=d,e[27]=u):u=e[27];let x;e[28]!==a?(x=a.length===0?s.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[s.jsx("p",{children:"No messages yet."}),s.jsx("p",{className:"text-sm",children:"Send a message to your phlebotomist!"})]}):a.map(se),e[28]=a,e[29]=x):x=e[29];let P;e[30]===Symbol.for("react.memo_cache_sentinel")?(P=s.jsx("div",{ref:V}),e[30]=P):P=e[30];let h;e[31]!==x?(h=s.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[x,P]}),e[31]=x,e[32]=h):h=e[32];let B;e[33]===Symbol.for("react.memo_cache_sentinel")?(B=t=>J(t.target.value),e[33]=B):B=e[33];let g;e[34]!==H||e[35]!==i||e[36]!==r?(g=s.jsx(U,{value:r,onChange:B,onKeyPress:H,placeholder:"Type a message...",className:"flex-1 rounded-full py-6",disabled:i}),e[34]=H,e[35]=i,e[36]=r,e[37]=g):g=e[37];let b;e[38]!==i||e[39]!==r?(b=!r.trim()||i,e[38]=i,e[39]=r,e[40]=b):b=e[40];let R;e[41]===Symbol.for("react.memo_cache_sentinel")?(R=s.jsx(Z,{className:"w-5 h-5"}),e[41]=R):R=e[41];let y;e[42]!==c||e[43]!==b?(y=s.jsx(Q,{onClick:c,disabled:b,size:"icon",className:"rounded-full h-12 w-12",children:R}),e[42]=c,e[43]=b,e[44]=y):y=e[44];let j;e[45]!==g||e[46]!==y?(j=s.jsx("div",{className:"p-4 border-t border-border bg-card",children:s.jsxs("div",{className:"flex gap-2",children:[g,y]})}),e[45]=g,e[46]=y,e[47]=j):j=e[47];let K;return e[48]!==u||e[49]!==h||e[50]!==j?(K=s.jsxs("div",{className:"fixed inset-0 bg-background z-50 flex flex-col",children:[u,h,j]}),e[48]=u,e[49]=h,e[50]=j,e[51]=K):K=e[51],K}function se(o){return s.jsx("div",{className:`flex ${o.sender_type==="patient"?"justify-end":"justify-start"}`,children:s.jsxs("div",{className:`max-w-[75%] px-4 py-2 rounded-2xl ${o.sender_type==="patient"?"bg-primary text-primary-foreground rounded-br-md":"bg-muted text-foreground rounded-bl-md"}`,children:[s.jsx("p",{children:o.message}),s.jsx("p",{className:`text-xs mt-1 ${o.sender_type==="patient"?"text-primary-foreground/70":"text-muted-foreground"}`,children:ee(new Date(o.created_at),"HH:mm")})]})},o.id)}export{ce as B};
