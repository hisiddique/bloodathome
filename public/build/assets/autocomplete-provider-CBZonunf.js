import{a as G,j as t,c as O}from"./app-Bmo3up5q.js";import{r as c}from"./stripe-DEhpSmJl.js";import{u as Z}from"./use-google-maps-Jf974WU7.js";import{I as M}from"./input-wNfwdC4B.js";import{c as N}from"./createLucideIcon-DVqpq5-V.js";import{L as E}from"./loader-circle-DNWwauI4.js";import{M as R}from"./map-pin-CUMyF97U.js";import{N as C}from"./navigation-DSG-f7Iq.js";/* empty css            */import"./mapbox-fioGkFd4.js";import"./google-maps-B08IT9Vv.js";function T({onPlaceSelect:p,placeholder:s="Enter UK postcode or address...",defaultValue:d,className:a}){const{googleMapsKey:n}=G().props,{isLoaded:f,loadError:i,google:g}=Z(n),h=c.useRef(null),b=c.useRef(null),[L,j]=c.useState(!1),[I,U]=c.useState(d||"");c.useEffect(()=>{if(!(!f||!g||!h.current||b.current))try{b.current=new g.maps.places.Autocomplete(h.current,{componentRestrictions:{country:"gb"},fields:["address_components","geometry","formatted_address"],types:["address","postal_code"]}),b.current.addListener("place_changed",()=>{if(!b.current)return;const o=b.current.getPlace();if(!o.geometry?.location){console.error("No geometry found for place");return}const l=o.geometry.location.lat(),w=o.geometry.location.lng();let x="";if(o.address_components){for(const u of o.address_components)if(u.types.includes("postal_code")){x=u.long_name;break}}if(!x&&o.formatted_address){const u=o.formatted_address.match(/[A-Z]{1,2}\d[A-Z\d]?\s*\d[A-Z]{2}/i);u&&(x=u[0].toUpperCase())}p({postcode:x||"N/A",lat:l,lng:w,formattedAddress:o.formatted_address||""}),U(o.formatted_address||x)})}catch(o){console.error("Error initializing autocomplete:",o)}},[f,g,p]);const A=()=>{if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}if(!g){alert("Google Maps not loaded yet");return}j(!0),navigator.geolocation.getCurrentPosition(async o=>{const{latitude:l,longitude:w}=o.coords;try{const u=await new g.maps.Geocoder().geocode({location:{lat:l,lng:w}});if(u.results&&u.results.length>0){const y=u.results[0];let v="";if(y.address_components){for(const e of y.address_components)if(e.types.includes("postal_code")){v=e.long_name;break}}if(!v&&y.formatted_address){const e=y.formatted_address.match(/[A-Z]{1,2}\d[A-Z\d]?\s*\d[A-Z]{2}/i);e&&(v=e[0].toUpperCase())}p({postcode:v||"N/A",lat:l,lng:w,formattedAddress:y.formatted_address||""}),U(y.formatted_address||v)}}catch(x){console.error("Reverse geocoding error:",x),alert("Unable to get your address. Please enter manually.")}finally{j(!1)}},o=>{console.error("Geolocation error:",o),j(!1);let l="Unable to get your location.";o.code===o.PERMISSION_DENIED?l="Location permission denied. Please enable it.":o.code===o.POSITION_UNAVAILABLE?l="Location information unavailable.":o.code===o.TIMEOUT&&(l="Location request timed out."),alert(l+" Please enter your postcode manually.")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})};return i||!n?t.jsx("div",{className:N("p-4 rounded-lg border border-border bg-muted text-center",a),children:t.jsx("p",{className:"text-sm text-muted-foreground",children:n?"Unable to load location search":"Google Maps API key not configured"})}):f?t.jsxs("div",{className:N("space-y-3",a),children:[t.jsxs("div",{className:"relative",children:[t.jsx(R,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground pointer-events-none"}),t.jsx(M,{ref:h,type:"text",value:I,onChange:o=>U(o.target.value),placeholder:s,className:"pl-12 pr-12 py-6 rounded-2xl border-border bg-card text-base"}),t.jsx("button",{type:"button",onClick:A,disabled:L,className:N("absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-lg","text-muted-foreground hover:text-foreground hover:bg-muted","transition-colors disabled:opacity-50 disabled:cursor-not-allowed"),title:"Use my location",children:L?t.jsx(E,{className:"w-5 h-5 animate-spin"}):t.jsx(C,{className:"w-5 h-5"})})]}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Start typing your UK postcode or address"})]}):t.jsxs("div",{className:N("relative flex items-center gap-2 p-4 rounded-2xl border border-border bg-card",a),children:[t.jsx(E,{className:"w-5 h-5 text-muted-foreground animate-spin"}),t.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading location search..."})]})}function K({onPlaceSelect:p,placeholder:s="Enter UK postcode or address...",defaultValue:d,className:a,mapboxToken:n}){const[f,i]=c.useState(d||""),[g,h]=c.useState([]),[b,L]=c.useState(!1),[j,I]=c.useState(!1),[U,A]=c.useState(!1),o=c.useRef(null),l=c.useRef(null),w=async e=>{if(!n||e.length<3){h([]);return}L(!0);try{const m=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(e)}.json?`+new URLSearchParams({access_token:n,country:"GB",types:"address,postcode,place",limit:"5"}))).json();m.features&&Array.isArray(m.features)&&(h(m.features),A(!0))}catch(r){console.error("Error fetching suggestions:",r)}finally{L(!1)}},x=e=>{i(e),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{w(e)},300)},u=e=>{const r=e.place_name.match(/[A-Z]{1,2}\d{1,2}[A-Z]?\s?\d[A-Z]{2}/i);if(r)return r[0].toUpperCase();if(e.context){for(const m of e.context)if(m.id.startsWith("postcode"))return m.text.toUpperCase()}return"N/A"},y=e=>{const[r,m]=e.center,_=u(e);p({postcode:_,lat:m,lng:r,formattedAddress:e.place_name}),i(e.place_name),A(!1),h([])},v=()=>{if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}if(!n){alert("Mapbox not configured");return}I(!0),navigator.geolocation.getCurrentPosition(async e=>{const{latitude:r,longitude:m}=e.coords;try{const S=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${m},${r}.json?`+new URLSearchParams({access_token:n,types:"address,postcode,place",limit:"1"}))).json();if(S.features&&S.features.length>0){const P=S.features[0],k=u(P);p({postcode:k,lat:r,lng:m,formattedAddress:P.place_name}),i(P.place_name)}}catch(_){console.error("Reverse geocoding error:",_),alert("Unable to get your address. Please enter manually.")}finally{I(!1)}},e=>{console.error("Geolocation error:",e),I(!1);let r="Unable to get your location.";e.code===e.PERMISSION_DENIED?r="Location permission denied. Please enable it.":e.code===e.POSITION_UNAVAILABLE?r="Location information unavailable.":e.code===e.TIMEOUT&&(r="Location request timed out."),alert(r+" Please enter your postcode manually.")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})};return c.useEffect(()=>{const e=r=>{l.current&&!l.current.contains(r.target)&&A(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),c.useEffect(()=>()=>{o.current&&clearTimeout(o.current)},[]),n?t.jsxs("div",{className:N("space-y-3",a),ref:l,children:[t.jsxs("div",{className:"relative",children:[t.jsx(R,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground pointer-events-none"}),t.jsx(M,{type:"text",value:f,onChange:e=>x(e.target.value),placeholder:s,className:"pl-12 pr-12 py-6 rounded-2xl border-border bg-card text-base",onFocus:()=>{g.length>0&&A(!0)}}),t.jsx("button",{type:"button",onClick:v,disabled:j,className:N("absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-lg","text-muted-foreground hover:text-foreground hover:bg-muted","transition-colors disabled:opacity-50 disabled:cursor-not-allowed"),title:"Use my location",children:j?t.jsx(E,{className:"w-5 h-5 animate-spin"}):t.jsx(C,{className:"w-5 h-5"})})]}),U&&g.length>0&&t.jsx("div",{className:"absolute z-50 w-full max-w-md bg-card border border-border rounded-xl shadow-lg overflow-hidden",children:g.map(e=>t.jsxs("button",{type:"button",onClick:()=>y(e),className:"w-full px-4 py-3 text-left hover:bg-muted transition-colors flex items-start gap-2",children:[t.jsx(R,{className:"w-4 h-4 mt-1 text-muted-foreground shrink-0"}),t.jsx("div",{className:"flex-1 min-w-0",children:t.jsx("div",{className:"text-sm text-foreground truncate",children:e.place_name})})]},e.id))}),b&&t.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[t.jsx(E,{className:"w-3 h-3 animate-spin"}),t.jsx("span",{children:"Searching..."})]}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Start typing your UK postcode or address"})]}):t.jsx("div",{className:N("p-4 rounded-lg border border-border bg-muted text-center",a),children:t.jsx("p",{className:"text-sm text-muted-foreground",children:"Mapbox access token not configured"})})}function X(p){const s=O.c(9);let d,a,n;if(s[0]!==p){const{provider:i,googleMapsKey:g,mapboxToken:h,...b}=p;n=i,a=h,d=b,s[0]=p,s[1]=d,s[2]=a,s[3]=n}else d=s[1],a=s[2],n=s[3];if(n==="mapbox"&&a){let i;return s[4]!==d||s[5]!==a?(i=t.jsx(K,{...d,mapboxToken:a}),s[4]=d,s[5]=a,s[6]=i):i=s[6],i}let f;return s[7]!==d?(f=t.jsx(T,{...d}),s[7]=d,s[8]=f):f=s[8],f}export{X as AutocompleteProvider,X as default};
