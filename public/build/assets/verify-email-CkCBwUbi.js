import{a as I,j as e,H as T,L as b,b as w,t as f,r as B}from"./app-DKMZLzfm.js";import{B as C}from"./button-BpuFCFGL.js";import{I as M}from"./input-aT928qqq.js";import{P as H}from"./public-layout-D4twQpY6.js";import{a as S}from"./index-DAEGULsz.js";import{r as n}from"./stripe-DEhpSmJl.js";import{C as K}from"./circle-check-big-doPPrHOW.js";import{M as E}from"./mail-B1fny5qI.js";import{L as k}from"./loader-circle-C-jBiGq1.js";/* empty css            */import"./mapbox-fioGkFd4.js";import"./sheet-COscS31w.js";import"./x-CVwgNE2J.js";import"./house-DAg0O8J9.js";import"./search-CYN13Cpu.js";import"./index-CMWG4mbA.js";function U({status:l}){const{props:V}=I(),x=V.auth?.user,[d,F]=n.useState(!!l),[i,g]=n.useState(["","","","","",""]),[m,j]=n.useState(!1),[p,y]=n.useState(!1),[c,h]=n.useState(0),[N,a]=n.useState(null),o=n.useRef([]);n.useEffect(()=>{l&&(h(15),setTimeout(()=>o.current[0]?.focus(),100))},[]),n.useEffect(()=>{if(c>0){const s=setTimeout(()=>h(c-1),1e3);return()=>clearTimeout(s)}},[c]);const v=async()=>{j(!0),a(null);try{const s=await w.post("/email/send-otp");s.data.success?(F(!0),h(15),f.success("Code sent!",{description:"Check your email for the verification code"}),setTimeout(()=>o.current[0]?.focus(),100)):a(s.data.message||"Failed to send code")}catch(s){const t=s.response?.data?.message||"Failed to send verification code. Please try again.";a(t),f.error("Error",{description:t})}finally{j(!1)}},P=async()=>{const s=i.join("");if(s.length!==6){a("Please enter all 6 digits");return}y(!0),a(null);try{const t=await w.post("/email/verify-otp",{otp:s});t.data.success?(f.success("Email verified!",{description:"Redirecting to dashboard..."}),setTimeout(()=>{B.visit("/dashboard")},1e3)):a(t.data.message||"Invalid verification code")}catch(t){const r=t.response?.data?.message||"Invalid verification code. Please try again.";a(r),f.error("Verification failed",{description:r})}finally{y(!1)}},D=(s,t)=>{if(t.length>1&&(t=t.slice(-1)),!/^\d*$/.test(t))return;const r=[...i];r[s]=t,g(r),a(null),t!==""&&s<5&&o.current[s+1]?.focus()},O=(s,t)=>{t.key==="Backspace"&&i[s]===""&&s>0&&o.current[s-1]?.focus()},L=s=>{s.preventDefault();const t=s.clipboardData.getData("text").slice(0,6);if(!/^\d+$/.test(t))return;const r=[...i];for(let u=0;u<t.length;u++)r[u]=t[u];g(r),a(null);const R=Math.min(t.length,5);o.current[R]?.focus()};return e.jsxs(e.Fragment,{children:[e.jsx(T,{title:"Verify Your Email"}),e.jsx("div",{className:"min-h-[calc(100vh-theme(spacing.16))] flex items-center justify-center py-12 px-4",children:e.jsxs("div",{className:"w-full max-w-md text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-6",children:d?e.jsx(K,{className:"w-8 h-8 text-green-600"}):e.jsx(E,{className:"w-8 h-8 text-primary"})}),e.jsx("h1",{className:"text-2xl font-bold text-foreground mb-2",children:d?"Code Sent!":"Verify Your Email"}),e.jsx("p",{className:"text-muted-foreground mb-8",children:d?e.jsxs(e.Fragment,{children:["Enter the 6-digit code sent to:",e.jsx("br",{}),e.jsx("span",{className:"font-medium text-foreground",children:x?.email})]}):e.jsxs(e.Fragment,{children:["We'll send a 6-digit verification code to:",e.jsx("br",{}),e.jsx("span",{className:"font-medium text-foreground",children:x?.email})]})}),d?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center gap-2",children:i.map((s,t)=>e.jsx(M,{ref:r=>o.current[t]=r,type:"text",inputMode:"numeric",maxLength:1,value:s,onChange:r=>D(t,r.target.value),onKeyDown:r=>O(t,r),onPaste:t===0?L:void 0,className:"w-12 h-14 text-center text-xl font-semibold",disabled:p},t))}),N&&e.jsx("p",{className:"text-sm text-red-600",children:N}),e.jsx(C,{onClick:P,disabled:p||i.join("").length!==6,className:"w-full",children:p?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-4 h-4 mr-2 animate-spin"}),"Verifying..."]}):"Verify Code"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:c>0?e.jsxs("p",{children:["Resend code in"," ",e.jsxs("span",{className:"font-medium",children:[c,"s"]})]}):e.jsx("button",{onClick:v,disabled:m,className:"text-primary hover:underline disabled:opacity-50",children:m?"Sending...":"Resend code"})}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx(b,{href:S(),method:"post",as:"button",className:"text-sm text-muted-foreground hover:text-foreground transition-colors",children:"Use a different email"})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(C,{onClick:v,disabled:m,className:"w-full",children:m?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending Code..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Send Verification Code"]})}),e.jsx("div",{className:"pt-4",children:e.jsx(b,{href:S(),method:"post",as:"button",className:"text-sm text-muted-foreground hover:text-foreground transition-colors",children:"Use a different email"})})]}),e.jsx("div",{className:"mt-8 p-4 bg-muted/50 rounded-2xl",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Didn't receive the code? Check your spam folder or make sure you entered the correct email address during registration."})})]})})]})}U.layout=l=>e.jsx(H,{children:l});export{U as default};
